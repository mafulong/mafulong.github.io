<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="wVZecs0Awis41AZhX45RBAUlyk3nnpoOkebdIemwhxQ" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>AWS Network &mdash; Fulongのblog</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/github.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/vendor/share.js/dist/css/share.min.css"><link rel="canonical" href="https://mafulong.github.io/2022/10/04/AWS-network/"><link rel="alternate" type="application/atom+xml" title="Fulongのblog" href="https://mafulong.github.io"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/favicon.ico"><meta property="og:title" content="AWS Network"><meta name="keywords" content="logbook, mafulong"><meta name="og:keywords" content="logbook, mafulong"><meta name="description" content="AWS VPC"><meta name="og:description" content="AWS VPC"><meta property="og:url" content="https://mafulong.github.io/2022/10/04/AWS-network/"><meta property="og:site_name" content="Fulongのblog"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2022-10-04"> <script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/js/main.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://mafulong.github.io/" title="Fulongのblog"><span class="octicon octicon-mark-github"></span> Fulongのblog</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://mafulong.github.io/" class=" site-header-nav-item" target="" title="Home">Home</a> <a href="https://mafulong.github.io/categories/" class=" site-header-nav-item" target="" title="Categories">Categories</a> <a href="https://mafulong.github.io/archives/" class=" site-header-nav-item" target="" title="Achieves">Achieves</a> <a href="https://mafulong.github.io/open-source" class=" site-header-nav-item" target="" title="Open-Source">Open-Source</a> <a href="https://mafulong.github.io/bookmark" class=" site-header-nav-item" target="" title="Bookmark">Bookmark</a> <a href="https://mafulong.github.io/about" class=" site-header-nav-item" target="" title="About">About</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="AWS Network"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">AWS Network</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2022/10/04 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://mafulong.github.io/categories/#AWS" title="AWS">AWS</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 10699 字，约 31 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"> <img style="height:72px;width:72px" src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/images/qrcode.jpg" alt="傻了吧" /></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><h1 id="aws-vpc">AWS VPC</h1><h2 id="名词解释">名词解释</h2><p><a href="https://docs.amazonaws.cn/vpc/latest/userguide/what-is-amazon-vpc.html">参考</a></p><ul><li><p><strong>Virtual Private Cloud (VPC)</strong></p><p><a href="https://docs.amazonaws.cn/vpc/latest/userguide/configure-your-vpc.html">VPC</a> 是一个虚拟网络，与您在自己的数据中心中运行的传统网络极为相似。创建 VPC 后，您可以添加子网。翻译成中文是虚拟私有云。</p></li><li><p><strong>子网</strong> <strong>Subnets</strong></p><p><a href="https://docs.amazonaws.cn/vpc/latest/userguide/configure-subnets.html">子网</a>是您的 VPC 内的 IP 地址范围。子网必须位于单个可用区中。在添加子网后，您可以在 VPC 中部署 Amazon 资源。</p></li><li><p><strong>IP 寻址</strong></p><p>您可以将 IPv4 地址和 IPv6 地址分配到 VPC 和子网。您还可以将您的公有 IPv4 和 IPv6 GUA 地址带到 Amazon 并将其分配到 VPC 中的资源，例如 EC2 实例、NAT 网关和网络负载均衡器。创建 VPC 时，需要为其分配一个 IPv4 CIDR 块（一系列私有 IPv4 地址）、一个 IPv6 CIDR 块或同时分配两种 CIDR 块（双堆栈）。</p><p>私有 IPv4 地址无法通过 Internet 访问。IPv6 地址具有全球唯一性，可以配置为保持私有或通过互联网进行访问。</p></li><li><p><strong>路由选择</strong></p><p>使用<a href="https://docs.amazonaws.cn/vpc/latest/userguide/VPC_Route_Tables.html">路由表</a>决定将来自您的子网或网关的网络流量定向到何处。</p></li><li><p><strong>网关和端点 ** **Gateways and endpoints</strong></p><p><a href="https://docs.amazonaws.cn/vpc/latest/userguide/extend-intro.html">网关</a>将您的 VPC 连到其他网络。例如，使用<a href="https://docs.amazonaws.cn/vpc/latest/userguide/VPC_Internet_Gateway.html">互联网网关</a>将您的 VPC 连接到网络。使用 <a href="https://docs.amazonaws.cn/vpc/latest/privatelink/privatelink-access-aws-services.html">VPC 端点</a>私下连接到 Amazon Web Services，无需使用互联网网关或 NAT 设备。</p></li><li><p><strong>对等连接</strong> <strong>Peering connections</strong></p><p>使用 <a href="https://docs.amazonaws.cn/vpc/latest/peering/">VPC 对等连接</a>在两个 VPC 中的资源之间路由流量。</p></li><li><p><strong>流量镜像</strong> <strong>Traffic Mirroring</strong></p><p>从网络接口<a href="https://docs.amazonaws.cn/vpc/latest/mirroring/">复制网络流量</a>，然后将其发送到安全和监控设备进行深度数据包检查。</p></li><li><p><strong>中转网关 ** **Transit gateways</strong></p><p>将<a href="https://docs.amazonaws.cn/vpc/latest/userguide/extend-tgw.html">中转网关</a>用作中央枢纽，以在 VPC、VPN 连接和 Amazon Direct Connect 连接之间路由流量。</p></li><li><p><strong>VPC 流日志</strong> <strong>VPC Flow Logs</strong></p><p><a href="https://docs.amazonaws.cn/vpc/latest/userguide/flow-logs.html">流日志</a>捕获有关在 VPC 中传入和传出网络接口的 IP 流量的信息。</p></li><li><p><strong>VPN 连接</strong></p><p>使用 <a href="https://docs.amazonaws.cn/vpc/latest/userguide/vpn-connections.html">Amazon Virtual Private Network (Amazon VPN)</a> 将 VPC 连接到您的本地网络。</p></li></ul><h2 id="vpc">VPC</h2><p><strong>Amazon Virtual Private Cloud (Amazon VPC)</strong>允许你在已定义的虚拟网络内启动AWS资源。这个虚拟网络与你在数据中心中运行的传统网络极其相似，并会为你提供使用AWS的可扩展基础设施的优势。</p><p>简单来说，VPC就是一个AWS用来隔离你的网络与其他客户网络的虚拟网络服务。在一个VPC里面，用户的数据会逻辑上地与其他AWS租户分离，用以保障数据安全。</p><p><strong>可以简单地理解为一个VPC就是一个虚拟的数据中心</strong>，在这个虚拟数据中心内我们可以创建不同的子网（公有网络和私有网络），搭建我们的网页服务器，应用服务器，数据库服务器等等服务。</p><h3 id="vpc有如下特点">VPC有如下特点</h3><ul><li><p>VPC内可以创建多个子网</p></li><li><p>可以在选择的子网上启动EC2实例</p></li><li><p>在每一个子网上分配自己规划的IP地址</p></li><li><p>每一个子网配置自己的路由表</p></li><li><p>创建一个Internet Gateway并且绑定到VPC上，让EC2实例可以访问互联网</p></li><li><p>VPC对你的AWS资源有更安全的保护</p></li><li><p>部署针对实例的安全组（Security Group）</p></li><li><p>部署针对子网的<strong>网络控制列表（Network Access Control List）</strong></p></li><li><p>一个VPC可以跨越多个可用区（AZ）</p></li><li><p><strong>一个子网只能在一个可用区（AZ）内</strong></p></li><li><p>安全组（Security Group）是有状态的，而网络控制列表（Network Access Control List）是无状态的</p><ul><li>有状态：如果入向流量被允许，则出向的响应流量会被自动允许</li></ul></li><li>无状态：入向规则和出向规则需要分别单独配置，互不影响<ul><li>具体的区别挨踢小茶会在后续的章节详细讲解</li></ul></li><li><p>VPC的子网掩码范围是从/28到/16，不能设置在这个范围外的子网掩码</p></li><li><p>VPC可以通过Virtual Private Gateway (VGW) 来与企业本地的数据中心相连</p></li><li>VPC可以通过AWS PrivateLink访问其他AWS账户托管的服务（VPC终端节点服务）</li></ul><h3 id="vpc-peering">VPC Peering</h3><p><strong>VPC Peering</strong>可是两个VPC之间的网络连接，通过此连接，你可以使用IPv4地址在两个VPC之间传输流量。这两个VPC内的实例会和如果在同一个网络一样彼此通信。</p><ul><li>可以通过AWS内网将一个VPC与另一个VPC相连</li><li>同一个AWS账号内的2个VPC可以进行VPC Peering</li><li>不同AWS账号内的VPC也可以进行VPC Peering</li><li>不支持VPC Transitive Peering 不支持传递<ul><li>如果VPC A和VPC B做了Peering</li><li>而且VPC B和VPC C做了Peering</li><li>那么VPC A是<strong>不能</strong>和VPC C进行通信的</li><li>要通信，只能将VPC A和VPC C进行Peering</li></ul></li></ul><h3 id="默认vpc">默认VPC</h3><ul><li>在每一个区域（Region），AWS都有一个默认的VPC</li><li>在这个VPC里面所有子网都绑定了一个路由表，其中有默认路由（目的地址 0.0.0.0/0）到互联网</li><li>所有在默认VPC内启动的EC2实例都可以直接访问互联网</li><li>在默认VPC内启动的EC2实例都会被分配公网地址和私有地址</li></ul><p>如下图所示，我们在某一个区域内有一个VPC，这个VPC的网络是172.31.0.0/16</p><p>在这个VPC内有2个子网，分别是172.31.0.0/20 和 172.31.16.0/20。这两个子网内都有一个EC2实例，每一个实例拥有一个该子网的私有地址（172.31.x.x）以及一个AWS分配的公网IP地址（203.0.113.x）。</p><p>这两个实例关联了一个主路由表，该路由表拥有一个访问172.31.0.0/16 VPC内流量的路由条目；还有一个目的为 0.0.0.0/0 的默认路由条目，指向Internet网关。</p><p>因此这两个实例都可以通过Internet网关访问外网。</p><p><img src="https://cdn.jsdelivr.net/gh/mafulong/mdPic@vv6/v6/202211192248477.png" alt="img" /></p><h3 id="vpc终端节点vpc-endpoints">VPC终端节点（VPC Endpoints）</h3><p>在一般的情况下，如果你需要访问S3服务，EC2实例或者DynamoDB的资源，你需要通过Internet公网来访问这些服务。有没有更快速、更安全的访问方式呢？</p><p><strong>VPC终端节点（VPC Endpoints）</strong>提供了这种可能性。</p><h3 id="privatelink">PrivateLink</h3><p>VPC终端节点能建立VPC和一些AWS服务之间的高速、私密的“专线”。这个专线叫做PrivateLink，使用了这个技术，你无需再使用Internet网关、NAT网关、VPN或AWS Direct Connect连接就可以访问到一些AWS资源了！</p><p>PrivateLink 是一种 Amazon Web Services (AWS) 的服务，它允许 AWS 中的服务与 VPC 内的资源进行安全、高速的连接，而无需通过公共 Internet。使用 PrivateLink，您可以将 AWS 中的服务（如 Amazon S3、Amazon EC2 等）作为一个私有端点，直接连接到 VPC 中的资源，从而实现私有、安全、低延迟的通信。</p><p>PrivateLink 使用 AWS VPC 内部的私有 IP 地址进行通信，这意味着您可以直接访问 AWS 中的服务，而不需要通过 NAT 网关或 VPN 连接。这样不仅可以提高通信的速度和稳定性，还可以提高安全性，因为数据和流量不会经过公共 Internet，不会受到网络威胁的影响。</p><p>使用 PrivateLink 时，您需要为要连接的 AWS 服务启用 PrivateLink，并在 VPC 中配置 VPC 端点。一旦配置完成，您就可以直接从 VPC 中的资源访问 AWS 服务，而不需要暴露公共 IP 地址。此外，PrivateLink 还支持跨账户连接，这意味着您可以将 AWS 服务连接到不同的 VPC 中的资源，从而实现更高的灵活性和可扩展性。</p><h3 id="vpc-peering-1">vpc peering</h3><p>VPC Peering 是指连接两个或多个 VPC 的网络连接。它允许您在不通过公共 Internet 的情况下直接路由流量到其他 VPC，从而实现跨 VPC 通信。这种通信是私有、安全和高效的。</p><p>VPC Peering 通常用于以下情况：</p><ul><li>允许不同 VPC 之间的资源进行互操作，以便跨多个 VPC 进行应用程序部署</li><li>实现基于 VPC 的多租户环境中的网络隔离，以确保租户之间的数据和流量不会相互干扰</li><li>扩展 VPC 中的可用 IP 地址范围，以满足需要更多 IP 地址的资源的要求，而不必更改 VPC CIDR</li></ul><p>在 VPC Peering 中，不同 VPC 之间的流量不会经过公共互联网，因此通信速度更快，并且更加安全。但需要注意的是，VPC Peering 是一种单向连接，这意味着必须分别设置每个 VPC 之间的连接，才能实现完全的互通性。</p><p>限制： ip 有overlap不能用。</p><h3 id="private-link-和-vpc-peering区别">private link 和 vpc peering区别</h3><p>VPC Peering 和 PrivateLink 都可以用于在 AWS 中建立安全、私有的网络连接，但它们的使用场景略有不同。</p><p>VPC Peering 主要用于连接不同 VPC 之间的网络，从而实现跨 VPC 通信。而 PrivateLink 主要用于连接 AWS 服务与 VPC 内的资源进行安全、高速的连接。</p><p>vpc peering是免费的，没有private link安全。</p><p>private link是收费的，更安全。</p><p>So when would you use VPC Peering versus PrivateLink?</p><p>VPC Peering is a good choice if you want to interconnect two or more VPCs within your company. You may also use it for integrating closely with trusted partners.</p><p>For sharing specific services with customers and partners, PrivateLink may be a better choice. It limits your exposure by providing access to a specific service rather than your entire network.</p><p>You’ll also need to use PrivateLink in a few specific scenarios:</p><ul><li>Connecting securely to AWS services from within a VPC</li><li>Connecting services in VPCs with overlapping IP ranges</li><li>Connecting securely to on-premise services from your VPCs</li></ul><h3 id="服务不一定都在vpc里">服务不一定都在vpc里</h3><p>服务不一定都在vpc里，比如公开可访问的s3。 但大部分服务都可以单独配置在vpc里，然后通过内部网络访问。</p><p>AWS 服务并不都在 VPC 中。AWS 提供的一些基础服务，如 Amazon S3、Amazon DynamoDB、Amazon SQS 等，都是通过公共网络提供的，您可以使用公共网络连接这些服务。</p><p>但是，大多数 AWS 服务都可以通过 Amazon VPC 进行访问，这意味着您可以将这些服务部署在您的 VPC 中，并通过 VPC 内部网络进行访问。例如，Amazon EC2 实例、Amazon RDS 数据库、Amazon ElastiCache 等服务都可以在 VPC 中部署，从而实现更安全、可靠的网络连接。</p><h2 id="工作原理">工作原理</h2><p><a href="https://docs.amazonaws.cn/vpc/latest/userguide/how-it-works.html">参考</a></p><h3 id="ip-寻址">IP 寻址</h3><p>创建 VPC 时，需要为其分配一个 IPv4 CIDR 块（一系列私有 IPv4 地址）、一个 IPv6 CIDR 块或同时分配两种 CIDR 块（双堆栈）。</p><p>私有 IPv4 地址无法通过 Internet 访问。IPv6 地址具有全球唯一性，可以配置为保持私有或通过互联网进行访问。</p><p>公有 IP 地址将从 Amazon 的公有 IP 地址池分配，它不与您的账户关联。在公有 IP 地址与您的实例取消关联后，该地址即释放回该池，并且不再可供您使用。您不能手动关联或取消关联公有 IP 地址。而是在某些情况下，我们从您的实例释放该公有 IP 地址，或向其分配新地址。有关更多信息，请参阅适用于 Linux 实例的 Amazon EC2 用户指南 中的公有 IP 地址。</p><h3 id="访问-internet">访问 Internet</h3><blockquote><p>私有网络不能访问互联网，需要互联网网关，私有网络内部之间可通信。</p></blockquote><p>原定设置 VPC 包含一个互联网网关，而且每个原定设置子网都是公有子网。您在默认子网中启动的每个实例都有一个私有 IPv4 地址和一个公有 IPv4 地址。这些实例可以通过 Internet 网关与 Internet 通信。通过互联网网关，您的实例可通过 Amazon EC2 网络边界连接到 Internet。</p><p>默认情况下，您启动到非默认子网中的每个实例都有一个私有 IPv4 地址，但没有公有 IPv4 地址，除非您在启动时特意指定一个，或者修改子网的公有 IP 地址属性。这些实例可以相互通信，但无法访问 Internet。</p><p>您可以通过以下方式为在非默认子网中启动的实例启用 Internet 访问：将一个互联网网关附加到该实例的 VPC（如果其 VPC 不是默认 VPC），然后将一个弹性 IP 地址与该实例相关联。</p><p>或者，您还可以使用网络地址转换 (NAT) 设备，以允许 VPC 中的实例发起到互联网的出站连接，但阻止来自互联网的未经请求的入站连接。NAT 将多个私有 IPv4 地址映射到一个公有 IPv4 地址。您可以使用弹性 IP 地址配置 NAT 设备，并通过互联网网关将其与互联网相连。您可以通过 NAT 设备将私有子网中的实例连接到互联网，NAT 设备会将来自实例的流量路由到互联网网关，并将所有响应路由到该实例。</p><p>如果您将 IPv6 CIDR 块与 VPC 关联并为实例分配 IPv6 地址，则实例可以通过互联网网关通过 IPv6 连接到互联网。或者，实例也可以使用仅出口互联网网关经由 IPv6 发起到互联网的出站连接。IPv6 流量独立于 IPv4 流量；您的路由表必须包含单独的 IPv6 流量路由。</p><p>默认情况下，默认子网为公有子网，因为主路由表会将指定发往 Internet 的子网流量发送到 Internet 网关。</p><h3 id="nat">NAT</h3><p>NAT的全程是“<strong>Network Address Translation</strong>”，中文解释是“<strong>网络地址转换</strong>”，它可以让整个机构只使用一个公有的IP地址出现在Internet上。</p><p>NAT是一种把内部私有地址（192.168.1.x，10.x.x.x等）转换为Internet公有地址的协议，它一定程度上解决了公网地址不足的问题。</p><ul><li>NAT实例需要创建在公有子网内</li></ul><p><strong>堡垒机（Bastion Host）</strong>又叫做跳板机（Jump Box），主要用于运维人员远程登陆服务器的集中管理。运维人员首先登陆到这台堡垒机（公网），然后再通过堡垒机管理位于内网的所有服务器。</p><p>堡垒机可以对运维人员的操作行为进行控制和审计，同时可以结合Token等技术达到更加安全的效果。</p><h2 id="vpc场景">VPC场景</h2><p><strong>带单个公有子网的 VPC</strong>： 此场景的配置包含一个有单一公有子网的 Virtual Private Cloud (VPC)，以及一个 Internet 网关以启用 Internet 通信。如果您要运行单一层级且面向公众的 Web 应用程序，如博客或简单的网站，则我们建议您使用此配置。</p><p><strong>带有公有和私有子网的 VPC (NAT)</strong>：这个场景的配置包括一个有公有子网和私有子网的 Virtual Private Cloud (VPC)。如果您希望运行面向公众的 Web 应用程序，并同时保留不可公开访问的后端服务器，我们建议您使用此场景。常用例子是一个多层网站，其 Web 服务器位于公有子网之内，数据库服务器则位于私有子网之内。您可以设置安全性和路由，以使 Web 服务器能够与数据库服务器建立通信。</p><p>公有子网中的实例可直接将出站流量发往 Internet，而私有子网中的实例不能这样做。但是，私有子网中的实例可使用位于公有子网中的网络地址转换 (NAT) 网关访问 Internet。数据库服务器可以使用 NAT 网关连接到 Internet 进行软件更新，但 Internet 不能建立到数据库服务器的连接。</p><h2 id="security-groups安全组">Security Groups（安全组）</h2><p><a href="https://zhuanlan.zhihu.com/p/151419823">参考</a></p><p>VPC 网络安全组标志 VPC 中的哪些流量可以发往 EC2 实例或从 EC2 发出。安全组指定具体的入向和出向流量规则，并精确到源地址（入向）和目的地址（出向）。这些安全组是与 EC2 实例而非子网关联的。 默认情况下，流量只允许出，不允许入。</p><p>Security Group（SG）通过控制IP和端口来控制出站入站规则，可以用于EC2，RDS及下面将要用到的VPC Endpoint。</p><h2 id="网络aclnacl">网络ACL（NACL）</h2><p><strong>网络访问控制列表（NACL）</strong>与安全组（Security Group）类似，它能在子网的层面控制所有入站和出站的流量，为VPC提供更加安全的保障。</p><ul><li>在你的<strong>默认VPC</strong>内会有一个默认的网络ACL（NACL），它会<strong>允许</strong>所有入向和出向的流量</li><li>你可以创建一个自定义的网络ACL，在创建之初所有的入向和出向的流量都会被<strong>拒绝</strong>，除非进行手动更改</li><li>对于所有VPC内的子网，每一个子网都需要关联一个网络ACL。如果没有关联任何网络ACL，那么子网会关联默认的网络ACL</li><li>一个网络ACL可以关联多个子网，但一个子网只能关联一个网络ACL</li><li>网络ACL包含了一系列（允许或拒绝）的规则，网络ACL会按顺序执行，一旦匹配就结束，不会再继续往下匹配</li><li>网络ACL有入向和出向的规则，每一条规则都可以配置允许或者拒绝</li><li>网络ACL是无状态的（安全组是有状态的）<ul><li>被允许的入向流量的响应流量必须被精准的出向规则所允许（反之亦然）</li><li>一般至少需要允许临时端口（TCP 1024-65535）</li><li>关于临时端口的知识，可以参见<a href="https://docs.aws.amazon.com/zh_cn/AmazonVPC/latest/UserGuide/VPC_ACLs.html#VPC_ACLs_Ephemeral_Ports">这里</a></li></ul></li></ul><h2 id="difference-between-internet-gateway-and-nat-gateway">Difference between Internet Gateway and NAT Gateway</h2><p><img src="https://cdn.jsdelivr.net/gh/mafulong/mdPic@vv6/v6/202210041648324.png" style="zoom:67%;" /></p><p>参考</p><ul><li>Internet Gateway (IGW) allows instances with public IPs to access the internet.</li><li>NAT Gateway (NGW) allows instances with no public IPs to access the internet.</li></ul><h2 id="参考">参考</h2><p><a href="https://juejin.cn/post/6949072638145003556">参考</a></p><p>大部分 AWS 服务都需要以 VPC 为基础进行构建，比如最常用的 EC2，ALB，及无服务器服务 ECS Fargate。 vb</p><p>当我们在一个 VPC 中创建 Subnet 时需要给 Subnet 选择一个 AZ（Availability Zone），一个 Subnet 只能选择建在一个 AZ 中。</p><p><strong>选择region</strong></p><p>因为国内政策法规原因，AWS 在中国的服务与 AWS Global 服务略有不同。</p><p>AWS Global 的 Region 之间是通过主干网相连的，AWS 中国区的服务没有通过主干网与 AWS Global 相连，只有中国区内部两个 Region，北京和宁夏是相连接的。</p><p>在创建 VPC 时并不需要添写 AZ（Availability Zone）信息，VPC 只与 Region 有关。</p><p>Subnet 是最终承载大部分 AWS 服务的组件，比如 EC2， ECS Fargate，RDS。</p><p>Subnet 分为两种 Private Subnet 和 Public Subnet。</p><p>简单来说，不能直接访问 internet 的 Subnet 就是 Private Subnet，能直接访问 internet 的就是 Public Subnet。</p><p>Security Group（SG）通过控制IP和端口来控制出站入站规则，可以用于EC2，RDS及下面将要用到的VPC Endpoint。</p><p>VPC Endpoint用来直接连接VPC与AWS相关服务，比如RDS AIP,S3。</p><p>当系统安全要求比较高时，EC2处于的Subnet可能被限制，无法访问internet，这时EC2就无法访问AWS的一些服务，比如SSM。</p><p>这时我们可以利用VPC Endpoint把VPC和所需要访问的服务连接起来，然后EC2就可以不经internet访问到所需的服务。</p><p><a href="https://juejin.cn/post/6954169148318433288">参考</a></p><p>RT（Route Table）与Subnet相关连，用来描述网络路由。IGW: Internet gateway IGW是一个独立的组件配置在VPC上，使得VPC可以访问internet</p><p>我们给VPC加了IGW之后，需要修改Subnet相关的路由，确保访问Internet的请求发送到IGW。</p><p>每个VPC中有一个默认的主RT，自动关联VPC内的每一个Subnet。我们现在为Subnet “ts-public-1”单独创建一个新的RT。</p><ul><li>新建的Subnet就是Private Subnet</li><li>在Private Subnet中配置了到IGW的路由后，就变成Public Subnet</li><li>Public Subnet中的EC2还要再配置一个Public IP或者EIP就可以访问Internet</li><li>如果EC2可以访问internet，其关联的Security Group入站规则如果允许从internet访问，那么这个EC2就可以从internet中直接访问到。</li></ul><ol><li><p>实践中我们把应用程序，数据库放在Private Subnet中，阻止从internet访问。把堡垒机和ALB（Application Load balancer）放在Public Subnet，允许从internet访问。</p></li><li><p>一般我们会建两套Public Subnet和Private Subnet，分别放在不同的AZ中，防止其中一个AZ出问题。这时如果配置NAT，也需要在两个Public Subnet中各配置一个NAT。</p></li></ol><p><a href="http://www.cloudbin.cn/?tag=aws">参考</a> 暂无Note</p><h2 id="总结">总结</h2><p>VPC里多个AZ, 每个AZ都需要至少一个子网，默认是公有子网。但如果有internet访问不到的实例或者数据库，则需建个私有子网，私有子网默认不能访问internet，internet也不能访问私有子网。</p><p>要走互联网必须走internet gateway，它对整个vpc生效, public subnet可直接通过IGW与互联网互联，私有子网再通过NAT走公有子网是可以访问internet的，反向不能。</p><p>和互联网连接时都需要有个公网ip，这个是从amazon分配的。</p><h1 id="跨账号访问aws-service总结">跨账号访问aws service总结</h1><p>比如 本账号lambda访问另一个账号的DDB</p><p>Lambda 跨账号访问另一个账号中的 DynamoDB 表，一共有以下几种方法：</p><ol><li>使用 assumeRole API：Lambda 函数在执行时使用 assumeRole API 切换到具有访问目标账号 DynamoDB 表权限的 IAM 角色。这种方法的优点是简单易用，只需要在代码中调用 assumeRole API 即可。缺点是需要进行额外的 IAM 角色配置和权限管理，同时存在一定的安全风险，因为将 IAM 凭证直接硬编码到代码中可能会导致安全问题。</li><li>使用 VPC Peering：通过建立 VPC Peering 连接，将源账号和目标账号的 VPC 相互连接起来，实现 Lambda 函数对 DynamoDB 表的访问。这种方法的优点是简单易用，可以通过 AWS 控制台完成配置，同时具有较高的安全性。缺点是需要进行 VPC 配置和管理，且无法实现跨区域访问。</li><li>使用 PrivateLink：通过在目标账号中创建一个 PrivateLink 终端节点，将 DynamoDB 表以私有方式暴露给源账号中的 Lambda 函数，实现跨账号访问。这种方法的优点是高度安全，可以通过 AWS PrivateLink 在私有网络中实现数据的加密传输，同时支持跨区域访问。缺点是需要进行较为复杂的 VPC 和 PrivateLink 配置，且可能需要进行网络安全设置和管理。</li><li>使用 AWS Resource Access Manager（RAM）：通过使用 RAM，可以在多个 AWS 账号之间共享资源，并授予其他 AWS 账号访问这些资源的权限。Lambda 函数可以将 RAM 中的资源授权给目标账号，从而实现对 DynamoDB 表的访问。这种方法的优点是可以实现资源共享和管理，并且具有高度的可扩展性。缺点是需要进行 RAM 的配置和管理，且可能需要进行跨账号 IAM 角色的授权和管理。</li></ol><p>一般来说，如果需要实现高度安全性和数据隔离，且需要支持跨区域访问，推荐使用 PrivateLink；如果只是需要简单快速地实现跨账号访问，可以选择使用 assumeRole API 或 VPC Peering。如果需要进行资源共享和管理，可以考虑使用 AWS RAM。</p><h1 id="route-53">Route 53</h1><p><strong>Amazon Route 53</strong>是一种高可用、高扩展性的云DNS服务。</p><p>Amazon Route 53 是一种托管域名系统 (DNS) 服务，它可帮助您为您的域名注册和管理 DNS 记录。您可以使用 Route 53 将您的域名映射到您的 VPC 内的资源，如 ELB 和 Amazon S3。</p><p>不同的DNS记录：</p><ul><li><strong>CNAME</strong> – CNAME （Canonical Name）可以将一个域名指向另一个域名。比如将aws.xiaopeiqing.com指向xiaopeiqing.com</li><li>Alias记录 – 和CNAME类似，又叫做别名记录，可以将一个域名指向另一个域名。<ul><li><strong>和CNAME最大的区别是，Alias可以应用在根域（Zone Apex）。即可以为xiaopeiqing.com的根域创建Alias记录，而不能创建CNAME</strong></li><li>别名记录可以节省你的时间，因为Route53会自动识别别名记录所指的记录中的更改。例如，假设example.com的一个别名记录指向位于lb1-1234.us-east-2.elb.amazonaws.com上的一个ELB负载均衡器。如果该负载均衡器的IP地址发生更改，Route53将在example.com的DNS应答中自动反映这些更改，而无需对包含example.com的记录的托管区域做出任何更改。 弹性负载均衡器（ELB）没有固定的IPv4地址，在使用ELB的时候永远使用它的DNS名字。很多场景下我们需要绑定DNS记录到ELB的endpoint地址，而不绑定任何IP</li></ul></li></ul><h1 id="aws-direct-connect">AWS Direct Connect</h1><p>AWS Direct Connect 是一种专用网络连接服务，它允许您通过私有连接连接到 AWS 服务。您可以使用 Direct Connect 将您的本地数据中心与您的 VPC 直接连接起来，实现更安全、更高带宽的网络连接。</p><p>AWS Direct Connect 是一种联网服务，提供了通过互联网连接到AWS 的替代方案。 使用AWS Direct Connect ，以前通过Internet 传输的数据将可以借助您的设施和AWS 之间的私有网络连接进行传输。</p><p><strong>不再需要通过网络提供商。</strong> 描述的是本地IT数据中心和VPC连接。通过物理专线连接。</p><p>AWS Direct Connect 通过标准的以太网光纤电缆将您的内部网络链接到 AWS Direct Connect 位置。电缆的一端接到您的路由器，另一端接到 AWS Direct Connect 路由器。有了这个连接，你可以创建<em>虚拟接口</em>直接公有公有访问AWS服务（例如，到 Amazon S3）或 Amazon VPC，绕过您的网络路径中的互联网服务提供商。网络 ACL 和安全组都允许 (因此可到达您的实例) 的发起 ping 的AWS Direct Connect位置提供访问AWS在与之关联的区域中。您可以将单个连接用于公有区域或AWS GovCloud (US)公有访问AWS所有其他公有区域中的服务。</p><p><a href="https://docs.aws.amazon.com/zh_cn/directconnect/latest/UserGuide/Welcome.html">参考</a></p></article><div class="share mobile-hidden"><div class="share-component"></div></div><div class="comment mobile-hidden"></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width: 96%" type="text" id="search_box" placeholder="Search" /></div><ul id="search_results" style=" font-size: 14px; list-style-type: none; padding-top: 10px; padding-left: 10px; " ></ul><script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/search_data.json', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 20, fuzzy: false, exclude: ['Welcome'] }); window.onload = function(){ var query_text = window.location.search.substring(1); var vars = query_text.split("&"); for (var i=0;i<vars.length;i++) { var pair = vars[i].split("="); if(pair[0] == "search_text"){ var query = pair[1]; query = decodeURI(query); var search = document.getElementById('search_box'); search.value = query; var event = new InputEvent('keyup'); search.dispatchEvent(event); break } } } </script><h3 class="post-directory-title">Table of Contents</h3><div id="post-directory-module"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/js/jquery.toc.js"></script><div class="mobile-hidden"><h3>Popular Posts</h3><ul><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2022/12/01/typescript%E7%AC%94%E8%AE%B0/">2022-12 typescript笔记</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2022/08/16/scala%E8%AF%AD%E6%B3%95/">2022-08 scala语法</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2021/12/26/etcd%E5%92%8Craft/">2021-12 etcd和raft</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2021/09/08/%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9/">2021-09 状态压缩</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2021/01/25/%E5%8D%9A%E5%BC%88%E8%AE%BA/">2021-01 博弈论</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2021/01/09/%E5%88%86%E5%B8%83%E5%BC%8F%E7%AE%97%E6%B3%95%E5%92%8C%E5%8D%8F%E8%AE%AE/">2021-01 分布式算法和协议</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2020/12/08/Kafka%E5%8E%9F%E7%90%861-%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84/">2020-12 kafka原理1-基础架构</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2020/12/08/ElasticSearch/">2020-12 ElasticSearch(ES)原理</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2020/11/29/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E6%80%BB%E7%BB%93/">2020-11 动态规划总结</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2020/11/12/%E7%BA%BF%E6%AE%B5%E6%A0%91/">2020-11 线段树</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2017/12/03/javascript%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">2017-12 javascript笔记</a></h6></ul></div></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2015 <span title="Fulong Ma">Fulong Ma</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="https://www.privacypolicygenerator.info/live.php?token=cnfKULv1VpqenfUs021YVA90fPiK75Cw">Privacy Policy</a></li><li> <a href="https://www.termsfeed.com/live/9dccd944-1b18-436d-bd12-3dd799b1282a">Terms </a></li><li> <a href="javascript:window.scrollTo(0,0)">TOP</a></li></ul><a href="https://github.com/mafulong/mafulong.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://mafulong.github.io/" title="Home" target="">Home</a></li><li> <a href="https://mafulong.github.io/categories/" title="Categories" target="">Categories</a></li><li> <a href="https://mafulong.github.io/archives/" title="Achieves" target="">Achieves</a></li><li> <a href="https://mafulong.github.io/open-source" title="Open-Source" target="">Open-Source</a></li><li> <a href="https://mafulong.github.io/bookmark" title="Bookmark" target="">Bookmark</a></li><li> <a href="https://mafulong.github.io/about" title="About" target="">About</a></li></ul><script async src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span></div></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script> <script> $(document).ready(function() { $("td img").each(function() { var strA = "<a href='" + this.src + "' itemscope=\"\" itemtype=\"http://schema.org/ImageObject\" itemprop=\"url\" data-fancybox=\"default\" rel=\"default\"></a>"; $(this).wrapAll(strA); }); $("p img").each(function() { var strA = "<a href='" + this.src + "' itemscope=\"\" itemtype=\"http://schema.org/ImageObject\" itemprop=\"url\" data-fancybox=\"default\" rel=\"default\"></a>"; $(this).wrapAll(strA); }); }); </script> <script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function ($) { $('.geopattern').each(function () { $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-SS4VDLWLNC"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() {dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SS4VDLWLNC'); </script></div></body></html>

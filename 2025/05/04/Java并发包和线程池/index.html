<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="google-site-verification" content="wVZecs0Awis41AZhX45RBAUlyk3nnpoOkebdIemwhxQ" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Javaå¹¶å‘åŒ…å’Œçº¿ç¨‹æ±  &mdash; Fulongã®blog</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/github.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/vendor/share.js/dist/css/share.min.css"><link rel="canonical" href="https://mafulong.github.io/2025/05/04/Java%E5%B9%B6%E5%8F%91%E5%8C%85%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0/"><link rel="alternate" type="application/atom+xml" title="Fulongã®blog" href="https://mafulong.github.io"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/favicon.ico"><meta property="og:title" content="Javaå¹¶å‘åŒ…å’Œçº¿ç¨‹æ± "><meta name="keywords" content="logbook, mafulong"><meta name="og:keywords" content="logbook, mafulong"><meta name="description" content="Javaå¹¶å‘åŒ…å’Œçº¿ç¨‹æ± "><meta name="og:description" content="Javaå¹¶å‘åŒ…å’Œçº¿ç¨‹æ± "><meta property="og:url" content="https://mafulong.github.io/2025/05/04/Java%E5%B9%B6%E5%8F%91%E5%8C%85%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0/"><meta property="og:site_name" content="Fulongã®blog"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2025-05-04"> <script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/js/main.js"></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://mafulong.github.io/" title="Fulongã®blog"><span class="octicon octicon-mark-github"></span> Fulongã®blog</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://mafulong.github.io/" class=" site-header-nav-item" target="" title="Home">Home</a> <a href="https://mafulong.github.io/categories/" class=" site-header-nav-item" target="" title="Categories">Categories</a> <a href="https://mafulong.github.io/archives/" class=" site-header-nav-item" target="" title="Achieves">Achieves</a> <a href="https://mafulong.github.io/open-source" class=" site-header-nav-item" target="" title="Open-Source">Open-Source</a> <a href="https://mafulong.github.io/bookmark" class=" site-header-nav-item" target="" title="Bookmark">Bookmark</a> <a href="https://mafulong.github.io/about" class=" site-header-nav-item" target="" title="About">About</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Javaå¹¶å‘åŒ…å’Œçº¿ç¨‹æ± "><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Javaå¹¶å‘åŒ…å’Œçº¿ç¨‹æ± </h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2025/05/04 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://mafulong.github.io/categories/#Java" title="Java">Java</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> å…± 14972 å­—ï¼Œçº¦ 43 åˆ†é’Ÿ </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><h2 id="javaå¹¶å‘åŒ…å’Œçº¿ç¨‹æ± ">Javaå¹¶å‘åŒ…å’Œçº¿ç¨‹æ± </h2><h2 id="jdk-å¹¶å‘åŒ…-juc">JDK å¹¶å‘åŒ… JUC</h2><p>java.util.concurrent</p><h3 id="é‡å…¥é”-reentrantlock">é‡å…¥é” ReentrantLock</h3><p>å‡ ä¸ªé‡è¦æ–¹æ³• re-entrance-lock</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
<span class="c1">//è·å¾—é”ï¼Œå¦‚å ç”¨ï¼Œåˆ™ç­‰å¾…</span>
<span class="n">lockInteruptibly</span><span class="o">()</span><span class="err">ï¼›</span>
<span class="c1">//è·å¾—é”ï¼Œä½†ä¼˜å…ˆå“åº”ä¸­æ–­ï¼Œå°±æ˜¯å¯ä»¥ä¸­æ–­çš„</span>
<span class="n">tryLock</span><span class="o">()</span><span class="err">ï¼›</span>
<span class="c1">//å¤±è´¥è¿”å›false,ä¸ç­‰å¾…</span>
<span class="n">tryLock</span><span class="o">(</span><span class="n">time</span><span class="o">,</span><span class="n">unit</span><span class="o">);</span>
<span class="c1">//åœ¨ç»™å®šæ—¶é—´å†…å°è¯•è·å¾—é”</span>
<span class="n">unlock</span><span class="o">();</span>
<span class="c1">//é‡Šæ”¾é”</span>
</code></pre></div></div><div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="n">int</span> <span class="n">num</span><span class="o">;</span>
<span class="k">private</span> <span class="n">static</span> <span class="k">final</span> <span class="nc">Lock</span> <span class="n">lock</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ReentrantLock</span><span class="o">();</span>
<span class="k">private</span> <span class="n">static</span> <span class="k">final</span> <span class="nc">Condition</span> <span class="n">condition</span> <span class="k">=</span> <span class="nv">lock</span><span class="o">.</span><span class="py">newCondition</span><span class="o">();</span>

<span class="nv">lock</span><span class="o">.</span><span class="py">lock</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="nf">while</span> <span class="o">(</span><span class="n">ä¸ç¬¦åˆæ¡ä»¶</span><span class="o">)</span> <span class="o">{</span>
    <span class="nv">condition</span><span class="o">.</span><span class="py">await</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="n">num</span><span class="o">++;</span>
  <span class="nv">System</span><span class="o">.</span><span class="py">out</span><span class="o">.</span><span class="py">print</span><span class="o">(</span><span class="nv">Thread</span><span class="o">.</span><span class="py">currentThread</span><span class="o">().</span><span class="py">getName</span><span class="o">());</span>
<span class="o">}</span> <span class="nf">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="nv">condition</span><span class="o">.</span><span class="py">signalAll</span><span class="o">();</span>
  <span class="nv">lock</span><span class="o">.</span><span class="py">unlock</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div><p>åœ¨ Java ä¸­ï¼Œé‡å…¥é”ï¼ˆReentrant Lockï¼‰æ˜¯ä¸€ç§æ”¯æŒ<strong>åŒä¸€çº¿ç¨‹é‡å¤è·å–é”è€Œä¸ä¼šè¢«é˜»å¡</strong>çš„é”æœºåˆ¶ã€‚å®ƒçš„å®ç°å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼š</p><ol><li>ä¸€ç§æ˜¯åŸºäº JVM çš„å†…ç½®é”ï¼ˆ<code class="language-plaintext highlighter-rouge">synchronized</code>ï¼‰ï¼›</li><li>ä¸€ç§æ˜¯åŸºäº JUC åŒ…çš„æ˜¾ç¤ºé”ï¼ˆå¦‚ <code class="language-plaintext highlighter-rouge">ReentrantLock</code>ï¼‰ã€‚</li></ol><p><strong>synchronized çš„é‡å…¥åŸç†ï¼ˆåŸºäº JVM å®ç°ï¼‰</strong> <strong>éå…¬å¹³é”</strong></p><ul><li><code class="language-plaintext highlighter-rouge">synchronized</code> æ˜¯åŸºäº<strong>å¯¹è±¡å¤´ï¼ˆObject Monitorï¼‰</strong>çš„ Monitor Lock å®ç°çš„ã€‚</li><li>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ª Monitorï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹å·²ç»è·å–äº†è¯¥ Monitorï¼Œå†æ¬¡è¿›å…¥æ—¶ä¼š<strong>å¢åŠ ä¸€ä¸ªè®¡æ•°å™¨</strong>ï¼ˆç§°ä¸ºé‡å…¥è®¡æ•°ï¼‰ã€‚</li><li>åªæœ‰å½“çº¿ç¨‹å®Œå…¨é€€å‡ºæ‰€æœ‰ <code class="language-plaintext highlighter-rouge">synchronized</code> å—åï¼Œæ‰ä¼šçœŸæ­£é‡Šæ”¾è¿™ä¸ªé”ã€‚</li></ul><p>ğŸ“Œ <strong>JVM ä¸­çš„é‡å…¥æœºåˆ¶ä¾èµ–äº Monitor çš„ Owner å’Œè®¡æ•°å™¨ï¼š</strong></p><ul><li>è®°å½•å½“å‰æŒé”çº¿ç¨‹ï¼ˆOwnerï¼‰ã€‚</li><li>å¦‚æœå½“å‰çº¿ç¨‹å†æ¬¡è¯·æ±‚é”ï¼Œåªéœ€å°†è®¡æ•°å™¨ <code class="language-plaintext highlighter-rouge">+1</code>ã€‚</li><li>é€€å‡ºæ—¶é€’å‡è®¡æ•°å™¨ï¼Œç›´åˆ°ä¸º 0 æ—¶é‡Šæ”¾ã€‚</li></ul><p><strong>ReentrantLock çš„é‡å…¥åŸç†ï¼ˆåŸºäº AQS å®ç°ï¼‰</strong> <strong>å…¬å¹³é”</strong></p><ul><li><code class="language-plaintext highlighter-rouge">ReentrantLock</code> æ˜¯åŸºäº <strong>AbstractQueuedSynchronizerï¼ˆAQSï¼‰</strong> å®ç°çš„ã€‚</li><li>AQS ä½¿ç”¨ä¸€ä¸ª volatile çš„ <code class="language-plaintext highlighter-rouge">state</code> å­—æ®µè®°å½•åŠ é”æ¬¡æ•°ï¼Œæ”¯æŒå¯é‡å…¥ã€‚</li><li>çº¿ç¨‹ç¬¬ä¸€æ¬¡è·å¾—é”æ—¶ï¼š<ul><li>è®¾ç½® state = 1ï¼Œå¹¶è®°å½•å½“å‰çº¿ç¨‹ä¸º ownerã€‚</li></ul></li><li>å¦‚æœ owner çº¿ç¨‹å†æ¬¡è¯·æ±‚ï¼š<ul><li>æ£€æŸ¥çº¿ç¨‹æ˜¯å¦ä¸ºå½“å‰ ownerï¼Œå¦‚æœæ˜¯å°±ç›´æ¥ state++ã€‚</li></ul></li><li>é‡Šæ”¾é”æ—¶ï¼š<ul><li>æ¯é‡Šæ”¾ä¸€æ¬¡ stateâ€“ï¼›</li><li>å½“ state ä¸º 0 æ—¶æ‰çœŸæ­£é‡Šæ”¾é”å¹¶å”¤é†’ç­‰å¾…çº¿ç¨‹ã€‚</li></ul></li></ul><h3 id="é‡å…¥é”çš„å¥½æ­æ¡£condition-æ¡ä»¶">é‡å…¥é”çš„å¥½æ­æ¡£ï¼šCondition æ¡ä»¶</h3><p>condition.await()å’Œ wait()ç±»ä¼¼</p><p>condition.signal()å’Œ notify()ç±»ä¼¼</p><p>è¦åœ¨ lock å—å†…ã€‚</p><p><strong>conditionå¯ä»¥æœ‰å¤šä¸ªï¼Œæ¯ä¸ªcondition.awaité˜»å¡åªèƒ½é€šè¿‡è¯¥conditionçš„signal/signalallæ¥å”¤é†’ï¼è¿™æ˜¯synchronizedå…³é”®å­—æ‰€è¾¾ä¸åˆ°çš„</strong></p><p>æ³¨æ„å¦‚æœsignalåœ¨awaitä¹‹å‰ï¼Œå¯èƒ½ä¼šé€šçŸ¥ä¸¢å¤±ï¼Œå˜æˆæ­»é”ï¼Œéšæ„æœ€å¥½ç”¨çŠ¶æ€å˜é‡æ¥å¾ªç¯è§£å†³ã€‚</p><p><code class="language-plaintext highlighter-rouge">Condition</code> çš„å®ç°åŸºäº <strong>AQS</strong>ï¼Œä¹Ÿå°±æ˜¯ <strong>AbstractQueuedSynchronizer</strong>ã€‚å®ƒèƒŒåçš„æ ¸å¿ƒåŸç†æ˜¯é€šè¿‡ <strong>ç­‰å¾…é˜Ÿåˆ—</strong> å’Œ <strong>é€šçŸ¥æœºåˆ¶</strong> æ¥åè°ƒçº¿ç¨‹çš„æ‰§è¡Œã€‚ çº¿ç¨‹è°ƒç”¨ <code class="language-plaintext highlighter-rouge">await()</code> æ–¹æ³•æ—¶ï¼Œ<strong>å½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·å¹¶åŠ å…¥åˆ° AQS çš„é˜Ÿåˆ—ä¸­</strong>ã€‚</p><p>å”¤é†’æ˜¯é€šè¿‡ <strong>è®¾ç½®çº¿ç¨‹çš„çŠ¶æ€</strong> æ¥å®ç°çš„ã€‚AQS ä¼šé€šè¿‡ <strong>CAS æ“ä½œ</strong> åŸå­åœ°æ”¹å˜çº¿ç¨‹çš„çŠ¶æ€ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><h3 id="semaphore">Semaphore</h3><p>ä¿¡å·é‡æœºåˆ¶</p><p>å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Semaphore</span> <span class="n">semaphore</span><span class="o">=</span><span class="k">new</span> <span class="n">semaphore</span><span class="o">(</span><span class="kt">int</span> <span class="n">permits</span><span class="o">);</span><span class="c1">//permitsæ˜¯ä¸ªè®¸å¯è¯</span>


<span class="n">run</span><span class="o">(){</span>
    <span class="n">semaphore</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>

    <span class="o">..</span>

    <span class="n">semaphore</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div><p>ä»¥ä¸‹ä»£ç æ¨¡æ‹Ÿäº†å¯¹æŸä¸ªæœåŠ¡çš„å¹¶å‘è¯·æ±‚ï¼Œæ¯æ¬¡åªèƒ½æœ‰ 3 ä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®ï¼Œè¯·æ±‚æ€»æ•°ä¸º 10ã€‚</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SemaphoreExample</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">clientCount</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">totalRequestCount</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
        <span class="nc">Semaphore</span> <span class="n">semaphore</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Semaphore</span><span class="o">(</span><span class="n">clientCount</span><span class="o">);</span>
        <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newCachedThreadPool</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">totalRequestCount</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">executorService</span><span class="o">.</span><span class="na">execute</span><span class="o">(()-&gt;{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">semaphore</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">semaphore</span><span class="o">.</span><span class="na">availablePermits</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                    <span class="n">semaphore</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">});</span>
        <span class="o">}</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>resutl: 2 1 2 2 2 2 2 1 2 2</p><p>å¾ªç¯æ‰“å°ABC.</p><div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ABCPrinter</span> <span class="o">{</span>
    <span class="c1">// åˆ›å»ºä¸‰ä¸ªä¿¡å·é‡ï¼Œç”¨äºæ§åˆ¶çº¿ç¨‹çš„æ‰§è¡Œé¡ºåº</span>
    <span class="k">private</span> <span class="n">static</span> <span class="k">final</span> <span class="nc">Semaphore</span> <span class="n">semaphoreA</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Semaphore</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="k">private</span> <span class="n">static</span> <span class="k">final</span> <span class="nc">Semaphore</span> <span class="n">semaphoreB</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Semaphore</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="k">private</span> <span class="n">static</span> <span class="k">final</span> <span class="nc">Semaphore</span> <span class="n">semaphoreC</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Semaphore</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Runnable</span> <span class="n">printA</span> <span class="k">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="nf">for</span> <span class="o">(</span><span class="n">int</span> <span class="n">i</span> <span class="k">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                    <span class="nv">semaphoreA</span><span class="o">.</span><span class="py">acquire</span><span class="o">();</span> <span class="c1">// ç­‰å¾…Açš„ä¿¡å·</span>
                    <span class="nv">System</span><span class="o">.</span><span class="py">out</span><span class="o">.</span><span class="py">print</span><span class="o">(</span><span class="s">"A"</span><span class="o">);</span>
                    <span class="nv">semaphoreB</span><span class="o">.</span><span class="py">release</span><span class="o">();</span> <span class="c1">// é‡Šæ”¾Bçš„ä¿¡å·</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="nf">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="nv">e</span><span class="o">.</span><span class="py">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">};</span>
<span class="err">ã€‚ã€‚ã€‚</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">Semaphore</code> çš„å®ç°åŸºäº <strong>AQSï¼ˆAbstractQueuedSynchronizerï¼‰</strong>ï¼Œé€šè¿‡ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨æ¥æ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°ã€‚æ¯å½“çº¿ç¨‹è¯·æ±‚èµ„æºæ—¶ï¼Œè®¡æ•°å™¨å‡å°‘ï¼Œå½“è®¡æ•°å™¨ä¸º 0 æ—¶ï¼Œåç»­çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚é€šè¿‡ <code class="language-plaintext highlighter-rouge">release()</code> æ–¹æ³•å¯ä»¥é‡Šæ”¾èµ„æºå¹¶å¢åŠ è®¡æ•°å™¨çš„å€¼ï¼Œå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚</p><h3 id="reentrantreadwritelock">ReentrantReadWriteLock</h3><p>è¯»å†™åˆ†ç¦»é”ï¼Œå¯ä»¥å‡å°‘é”ç«äº‰ï¼Œæå‡æ€§èƒ½</p><p><code class="language-plaintext highlighter-rouge">ReentrantReadWriteLock</code> å†…éƒ¨é€šè¿‡ä¸€ä¸ª <strong>state</strong> å­—æ®µæ¥è¡¨ç¤ºé”çš„çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€ç”± <strong>é«˜ 16 ä½</strong> å’Œ <strong>ä½ 16 ä½</strong> ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p><ul><li><strong>é«˜ 16 ä½</strong>ï¼šè¡¨ç¤ºå†™é”çš„æ•°é‡ã€‚</li><li><strong>ä½ 16 ä½</strong>ï¼šè¡¨ç¤ºè¯»é”çš„æ•°é‡ã€‚</li></ul><p><code class="language-plaintext highlighter-rouge">ReentrantReadWriteLock</code> æ˜¯å…¶å¸¸è§çš„å®ç°ï¼Œå®ƒä½¿ç”¨ <strong>AQSï¼ˆAbstractQueuedSynchronizerï¼‰</strong> æ¥åè°ƒçº¿ç¨‹é—´çš„å¹¶å‘è®¿é—®ã€‚è¯»é”æ˜¯å…±äº«é”ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æŒæœ‰ï¼›å†™é”æ˜¯ç‹¬å é”ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰å†™é”ï¼Œä¸”åœ¨å†™é”æŒæœ‰æœŸé—´ï¼Œä¸å…è®¸ä»»ä½•çº¿ç¨‹è¯»å–æˆ–å†™å…¥èµ„æºã€‚</p><h4 id="stampedlock">StampedLock</h4><p><code class="language-plaintext highlighter-rouge">StampedLock</code> æ˜¯ Java 8 ä¸­å¼•å…¥çš„ä¸€ä¸ªæ–°å‹é”ï¼Œæä¾›æ¯” <code class="language-plaintext highlighter-rouge">ReentrantReadWriteLock</code> æ›´é«˜æ•ˆçš„å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œå°¤å…¶é€‚ç”¨äºéœ€è¦å¤§é‡è¯»æ“ä½œçš„åœºæ™¯ã€‚<code class="language-plaintext highlighter-rouge">StampedLock</code> ä¹Ÿé€šè¿‡ <code class="language-plaintext highlighter-rouge">ReentrantLock</code> çš„æœºåˆ¶æ¥å®ç°ã€‚</p><ul><li><strong>å†™é”</strong>ï¼šç‹¬å é”ã€‚</li><li><strong>æ‚²è§‚è¯»é”</strong>ï¼šç±»ä¼¼äº <code class="language-plaintext highlighter-rouge">ReentrantReadWriteLock</code> çš„è¯»é”ã€‚</li><li><strong>ä¹è§‚è¯»é”</strong>ï¼šå…è®¸åœ¨ä¸æŒæœ‰é”çš„æƒ…å†µä¸‹è¯»å–æ•°æ®ï¼Œåœ¨æäº¤ä¹‹å‰æ£€æŸ¥æ•°æ®æ˜¯å¦è¢«ä¿®æ”¹è¿‡ã€‚</li></ul><h3 id="countdownlatch">CountdownLatch</h3><p>å°±æ˜¯å€’è®¡æ•°çš„é”å­˜æœŸï¼Œå¯ä»¥è®©çº¿ç¨‹ç­‰å¾…ç›´åˆ°å€’è®¡æ—¶ç»“æŸï¼Œå†å¼€å§‹æ‰§è¡Œ</p><p>ç”¨æ¥æ§åˆ¶ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¤šä¸ªçº¿ç¨‹ã€‚</p><p>ç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°å™¨ cntï¼Œæ¯æ¬¡è°ƒç”¨ countDown() æ–¹æ³•ä¼šè®©è®¡æ•°å™¨çš„å€¼å‡ 1ï¼Œå‡åˆ° 0 çš„æ—¶å€™ï¼Œé‚£äº›å› ä¸ºè°ƒç”¨ await() æ–¹æ³•è€Œåœ¨ç­‰å¾…çš„çº¿ç¨‹å°±ä¼šè¢«å”¤é†’ã€‚</p><p><strong>å®ç°åŸç†ï¼š</strong> <code class="language-plaintext highlighter-rouge">CountDownLatch</code> çš„åº•å±‚é€šè¿‡ AQS å®ç°ï¼Œä½¿ç”¨ä¸€ä¸ª volatile çš„ state å˜é‡è¡¨ç¤ºå€’è®¡æ—¶ï¼Œçº¿ç¨‹é€šè¿‡ <code class="language-plaintext highlighter-rouge">await()</code> è¿›å…¥ AQS çš„ CLH åŒå‘ç­‰å¾…é˜Ÿåˆ—é˜»å¡ã€‚ æ¯ä¸ªè°ƒç”¨ <code class="language-plaintext highlighter-rouge">countDown()</code> çš„çº¿ç¨‹åŸå­æ€§åœ°å°† state å‡ä¸€ï¼Œå½“ state å˜ä¸º 0 æ—¶ï¼Œè°ƒç”¨ <code class="language-plaintext highlighter-rouge">releaseShared()</code> å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountdownLatchExample</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">totalThread</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
        <span class="nc">CountDownLatch</span> <span class="n">countDownLatch</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CountDownLatch</span><span class="o">(</span><span class="n">totalThread</span><span class="o">);</span>
        <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newCachedThreadPool</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">totalThread</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">executorService</span><span class="o">.</span><span class="na">execute</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"run.."</span><span class="o">);</span>
                <span class="n">countDownLatch</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span>
            <span class="o">});</span>
        <span class="o">}</span>
        <span class="n">countDownLatch</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"end"</span><span class="o">);</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>result:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>run..run..run..run..run..run..run..run..run..run..end
</code></pre></div></div><h3 id="cyclicbarrier">CyclicBarrier</h3><p>å…è®¸ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°éƒ½åˆ°è¾¾æŸä¸ªå…¬å…±å±éšœç‚¹</p><p>ç”¨æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œåªæœ‰å½“å¤šä¸ªçº¿ç¨‹éƒ½åˆ°è¾¾æ—¶ï¼Œè¿™äº›çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚</p><p>å’Œ CountdownLatch ç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ç»´æŠ¤è®¡æ•°å™¨æ¥å®ç°çš„ã€‚ä½†æ˜¯å®ƒçš„è®¡æ•°å™¨æ˜¯é€’å¢çš„ï¼Œæ¯æ¬¡æ‰§è¡Œ await() æ–¹æ³•ä¹‹åï¼Œè®¡æ•°å™¨ä¼šåŠ  1ï¼Œç›´åˆ°è®¡æ•°å™¨çš„å€¼å’Œè®¾ç½®çš„å€¼ç›¸ç­‰ï¼Œç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚å’Œ CountdownLatch çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼ŒCyclicBarrier çš„è®¡æ•°å™¨å¯ä»¥å¾ªç¯ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒæ‰å«åšå¾ªç¯å±éšœã€‚</p><p>è¿™ä¸ªæ˜¯è§„å®šå¤šå°‘ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸€å®šæ•°é‡çš„çº¿ç¨‹éƒ½åˆ°è¾¾ await()æ—¶æ‰å¼€å§‹éƒ½å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œ</p><p><strong>å®ç°åŸç†</strong>ï¼š<code class="language-plaintext highlighter-rouge">CyclicBarrier</code> å†…éƒ¨é€šè¿‡ <code class="language-plaintext highlighter-rouge">ReentrantLock</code> å’Œ <code class="language-plaintext highlighter-rouge">Condition</code> æ§åˆ¶çº¿ç¨‹çš„é˜»å¡ä¸å”¤é†’ï¼Œæ¯æ¬¡æœ‰çº¿ç¨‹è°ƒç”¨ <code class="language-plaintext highlighter-rouge">await()</code>ï¼Œéƒ½ä¼šå°† <code class="language-plaintext highlighter-rouge">count</code> å‡ 1ï¼Œå½“æœ€åä¸€ä¸ªçº¿ç¨‹åˆ°è¾¾æ—¶æ‰§è¡Œ <code class="language-plaintext highlighter-rouge">barrierAction</code>ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œç„¶åå”¤é†’æ‰€æœ‰çº¿ç¨‹ï¼›ä¸ºäº†æ”¯æŒå¤šè½®ä½¿ç”¨ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªå« <code class="language-plaintext highlighter-rouge">generation</code> çš„å¯¹è±¡æ ‡è®°æ¯ä¸€è½®å±éšœï¼›å…¶è®¾è®¡ä½“ç°äº†ç»å…¸çš„â€œå±éšœâ€åŒæ­¥æ¨¡å¼ï¼Œéå¸¸é€‚ç”¨äºå¤šçº¿ç¨‹å¹¶å‘é˜¶æ®µä»»åŠ¡ã€‚</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CyclicBarrierExample</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">totalThread</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
        <span class="nc">CyclicBarrier</span> <span class="n">cyclicBarrier</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CyclicBarrier</span><span class="o">(</span><span class="n">totalThread</span><span class="o">);</span>
        <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newCachedThreadPool</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">totalThread</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">executorService</span><span class="o">.</span><span class="na">execute</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"before.."</span><span class="o">);</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="n">cyclicBarrier</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">BrokenBarrierException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"after.."</span><span class="o">);</span>
            <span class="o">});</span>
        <span class="o">}</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div><p>result:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>before..before..before..before..before..before..before..before..before..before..after..after..after..after..after..after..after..after..after..after..
</code></pre></div></div><h3 id="exchanger">Exchanger</h3><p>ç”¨äºä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´æ•°æ®çš„åŒæ­¥äº¤æ¢ï¼Œéƒ½å‡†å¤‡å¥½æ‰äº¤æ¢</p><div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">final</span> <span class="nc">Exchanger</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">exchanger</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Exchanger</span><span class="o">&lt;&gt;();</span>
        
        <span class="c1">// Thread 1: Producer</span>
        <span class="nc">Thread</span> <span class="n">producer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">message</span> <span class="k">=</span> <span class="s">"Hello from producer!"</span><span class="o">;</span>
                <span class="nv">System</span><span class="o">.</span><span class="py">out</span><span class="o">.</span><span class="py">println</span><span class="o">(</span><span class="s">"Producer before exchange: "</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
                <span class="nc">String</span> <span class="n">response</span> <span class="k">=</span> <span class="nv">exchanger</span><span class="o">.</span><span class="py">exchange</span><span class="o">(</span><span class="n">message</span><span class="o">);</span> <span class="c1">// äº¤æ¢æ•°æ®</span>
                <span class="nv">System</span><span class="o">.</span><span class="py">out</span><span class="o">.</span><span class="py">println</span><span class="o">(</span><span class="s">"Producer after exchange: "</span> <span class="o">+</span> <span class="n">response</span><span class="o">);</span>
            <span class="o">}</span> <span class="nf">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="nv">Thread</span><span class="o">.</span><span class="py">currentThread</span><span class="o">().</span><span class="py">interrupt</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="c1">// Thread 2: Consumer</span>
        <span class="nc">Thread</span> <span class="n">consumer</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">message</span> <span class="k">=</span> <span class="s">"Hello from consumer!"</span><span class="o">;</span>
                <span class="nv">System</span><span class="o">.</span><span class="py">out</span><span class="o">.</span><span class="py">println</span><span class="o">(</span><span class="s">"Consumer before exchange: "</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
                <span class="nc">String</span> <span class="n">response</span> <span class="k">=</span> <span class="nv">exchanger</span><span class="o">.</span><span class="py">exchange</span><span class="o">(</span><span class="n">message</span><span class="o">);</span> <span class="c1">// äº¤æ¢æ•°æ®</span>
                <span class="nv">System</span><span class="o">.</span><span class="py">out</span><span class="o">.</span><span class="py">println</span><span class="o">(</span><span class="s">"Consumer after exchange: "</span> <span class="o">+</span> <span class="n">response</span><span class="o">);</span>
            <span class="o">}</span> <span class="nf">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="nv">Thread</span><span class="o">.</span><span class="py">currentThread</span><span class="o">().</span><span class="py">interrupt</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>

</code></pre></div></div><p><code class="language-plaintext highlighter-rouge">Exchanger</code> åº•å±‚çš„æ ¸å¿ƒç»“æ„æ˜¯ä¸€ä¸ª <strong>åŒå‘é“¾è¡¨</strong> æˆ– <strong>èŠ‚ç‚¹ï¼ˆNodeï¼‰</strong>ã€‚æ¯å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code class="language-plaintext highlighter-rouge">exchange()</code> æ–¹æ³•æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹å¹¶å°†è‡ªå·±æ’å…¥é“¾è¡¨ä¸­ï¼Œè¡¨ç¤ºå®ƒæ­£ç­‰å¾…äº¤æ¢æ•°æ®ã€‚å¦ä¸€çº¿ç¨‹è°ƒç”¨ <code class="language-plaintext highlighter-rouge">exchange()</code> æ—¶ï¼Œä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œç­‰å¾…ä¸ç¬¬ä¸€ä¸ªçº¿ç¨‹äº¤æ¢æ•°æ®ã€‚</p><p>ä¸€æ—¦ä¸¤ä¸ªçº¿ç¨‹éƒ½å‡†å¤‡å¥½äº¤æ¢æ•°æ®ï¼Œå®ƒä»¬ä¼šåœ¨è¿™ä¸ªé“¾è¡¨ä¸­äº¤æ¢å„è‡ªçš„æ•°æ®ã€‚</p><ol><li><strong><code class="language-plaintext highlighter-rouge">transferer</code></strong>: <code class="language-plaintext highlighter-rouge">Exchanger</code> å†…éƒ¨ä½¿ç”¨äº† <code class="language-plaintext highlighter-rouge">Transferer</code> æ¥å£çš„å®ç°ç±»æ¥ç®¡ç†çº¿ç¨‹é—´çš„äº¤æ¢ã€‚<code class="language-plaintext highlighter-rouge">Transferer</code> å®é™…ä¸Šæ˜¯ç”¨æ¥å®ç°æ•°æ®äº¤æ¢çš„æ¥å£ï¼Œå®ƒæœ‰å¤šä¸ªå®ç°ç±»ï¼Œç”¨äºä¸åŒçš„åŒæ­¥éœ€æ±‚ã€‚</li><li><strong><code class="language-plaintext highlighter-rouge">Item</code></strong>: ç”¨æ¥å­˜æ”¾çº¿ç¨‹äº¤æ¢çš„æ•°æ®çš„å¯¹è±¡ã€‚åœ¨ <code class="language-plaintext highlighter-rouge">Exchanger</code> å†…éƒ¨ï¼Œçº¿ç¨‹ä¼šæŒæœ‰ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Item</code>ï¼Œæ¯ä¸ªçº¿ç¨‹ä¼ å…¥çš„æ•°æ®éƒ½ä¼šå­˜å‚¨åœ¨ <code class="language-plaintext highlighter-rouge">Item</code> ä¸­ã€‚</li><li><strong><code class="language-plaintext highlighter-rouge">Node</code></strong>: <code class="language-plaintext highlighter-rouge">Node</code> æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨çš„èŠ‚ç‚¹ã€‚æ¯å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ <code class="language-plaintext highlighter-rouge">exchange()</code> æ—¶ï¼Œçº¿ç¨‹å°±ä¼šåœ¨å†…éƒ¨çš„åŒå‘é“¾è¡¨ä¸­åˆ›å»ºä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Node</code> æ¥ç­‰å¾…äº¤æ¢ã€‚</li><li><strong>é”ä¸æ¡ä»¶å˜é‡</strong>:<ul><li><code class="language-plaintext highlighter-rouge">ReentrantLock</code>ï¼šç”¨äºç¡®ä¿å¯¹å…±äº«èµ„æºçš„äº’æ–¥è®¿é—®ã€‚</li><li><code class="language-plaintext highlighter-rouge">Condition</code>ï¼šç”¨äºå®ç°çº¿ç¨‹çš„ç­‰å¾…ä¸é€šçŸ¥æœºåˆ¶ã€‚æ¯ä¸ªçº¿ç¨‹åœ¨ <code class="language-plaintext highlighter-rouge">exchange()</code> è°ƒç”¨æ—¶éƒ½ä¼šè¢«æ”¾å…¥ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°ä¸å¦ä¸€ä¸ªçº¿ç¨‹äº¤æ¢æ•°æ®ã€‚</li></ul></li></ol><p><strong>æ ¸å¿ƒæµç¨‹</strong></p><ol><li>çº¿ç¨‹è°ƒç”¨ <code class="language-plaintext highlighter-rouge">exchange()</code> æ–¹æ³•</li></ol><p>å½“çº¿ç¨‹è°ƒç”¨ <code class="language-plaintext highlighter-rouge">exchange()</code> æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹å¹¶åŠ å…¥åˆ°äº¤æ¢çš„é˜Ÿåˆ—ä¸­ã€‚èŠ‚ç‚¹ä¿å­˜äº†å½“å‰çº¿ç¨‹çš„æ•°æ®ï¼Œå¹¶ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ¥äº¤æ¢æ•°æ®ã€‚</p><ul><li>çº¿ç¨‹ A è°ƒç”¨ <code class="language-plaintext highlighter-rouge">exchange()</code>ï¼Œå¹¶å°†å…¶æ•°æ®å­˜å‚¨åœ¨èŠ‚ç‚¹ä¸­ï¼Œç­‰å¾…ä¸çº¿ç¨‹ B äº¤æ¢æ•°æ®ã€‚</li><li>çº¿ç¨‹ B è°ƒç”¨ <code class="language-plaintext highlighter-rouge">exchange()</code>ï¼Œå¹¶å°†å…¶æ•°æ®å­˜å‚¨åœ¨èŠ‚ç‚¹ä¸­ï¼Œç­‰å¾…ä¸çº¿ç¨‹ A äº¤æ¢æ•°æ®ã€‚</li></ul><ol><li>çº¿ç¨‹é˜»å¡ä¸ç­‰å¾…</li></ol><ul><li>å½“çº¿ç¨‹ A è°ƒç”¨ <code class="language-plaintext highlighter-rouge">exchange()</code> åï¼Œå®ƒä¼šè°ƒç”¨ <code class="language-plaintext highlighter-rouge">lock.lock()</code> è·å–é”ï¼Œç„¶åæ£€æŸ¥æ˜¯å¦æœ‰å¦ä¸€ä¸ªçº¿ç¨‹å·²ç»åœ¨ç­‰å¾…äº¤æ¢ã€‚</li><li>å¦‚æœçº¿ç¨‹ B ä¹Ÿå·²ç»åœ¨ç­‰å¾…ï¼Œ<code class="language-plaintext highlighter-rouge">Exchanger</code> ä¼šäº¤æ¢å®ƒä»¬çš„æ•°æ®ã€‚</li><li>å¦‚æœçº¿ç¨‹ A æ²¡æœ‰æ‰¾åˆ°çº¿ç¨‹ B æ¥äº¤æ¢æ•°æ®ï¼Œå®ƒä¼šè°ƒç”¨ <code class="language-plaintext highlighter-rouge">condition.await()</code> é˜»å¡è‡ªå·±ï¼Œç›´åˆ°çº¿ç¨‹ B å‡†å¤‡å¥½äº¤æ¢æ•°æ®ã€‚</li></ul><ol><li>çº¿ç¨‹äº¤æ¢æ•°æ®</li></ol><ul><li>ä¸€æ—¦çº¿ç¨‹ A å’Œçº¿ç¨‹ B éƒ½å‡†å¤‡å¥½äº†äº¤æ¢æ•°æ®ï¼Œ<code class="language-plaintext highlighter-rouge">Exchanger</code> ä¼šå°†å®ƒä»¬å„è‡ªçš„æ•°æ®äº¤æ¢ã€‚çº¿ç¨‹ A ä¼šä»çº¿ç¨‹ B è·å–æ•°æ®ï¼Œè€Œçº¿ç¨‹ B ä¼šä»çº¿ç¨‹ A è·å–æ•°æ®ã€‚</li><li>äº¤æ¢å®Œæˆåï¼Œçº¿ç¨‹ä¼šè¢«é€šçŸ¥ç»§ç»­æ‰§è¡Œã€‚</li></ul><ol><li>é€šçŸ¥ä¸ç»§ç»­æ‰§è¡Œ</li></ol><ul><li>äº¤æ¢å®Œæˆåï¼Œ<code class="language-plaintext highlighter-rouge">Exchanger</code> ä¼šä½¿ç”¨ <code class="language-plaintext highlighter-rouge">condition.signalAll()</code> æ¥é€šçŸ¥æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ï¼Œè®©å®ƒä»¬ç»§ç»­æ‰§è¡Œã€‚</li></ul><h3 id="æ€»ç»“">æ€»ç»“</h3><p>Semaphore synchronized CountDownLatch ä¸ä¾èµ–äºé‡å…¥é”ã€‚</p><p><code class="language-plaintext highlighter-rouge">FutureTask</code>ï¼šä¸æ˜¯ç”¨ <code class="language-plaintext highlighter-rouge">ReentrantLock</code>ï¼Œè€Œæ˜¯ AQS å®ç°</p><p>å…¶ä»–JUCåŸºæœ¬ä¾èµ–äºé‡å…¥é”ã€‚</p><h2 id="å¹¶å‘æ•°æ®ç»“æ„">å¹¶å‘æ•°æ®ç»“æ„</h2><table><thead><tr><th>ç±»å</th><th>æ•°æ®ç»“æ„</th><th>åŒæ­¥æœºåˆ¶</th></tr></thead><tbody><tr><td><strong><code class="language-plaintext highlighter-rouge">ConcurrentHashMap</code></strong></td><td>æ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘ + åˆ†æ®µé”/CAS</td><td>åˆ†æ®µé”ï¼ˆJDK7ï¼‰ï¼ŒCAS + synchronizedï¼ˆJDK8ï¼‰</td></tr><tr><td><code class="language-plaintext highlighter-rouge">ConcurrentSkipListMap</code></td><td>è·³è¡¨ï¼ˆSkipListï¼‰</td><td>CAS + volatile</td></tr><tr><td><code class="language-plaintext highlighter-rouge">ConcurrentLinkedQueue</code></td><td>é“¾è¡¨</td><td>CASï¼ˆæ— é”ï¼‰</td></tr><tr><td><code class="language-plaintext highlighter-rouge">ConcurrentLinkedDeque</code></td><td>åŒå‘é“¾è¡¨</td><td>CASï¼ˆæ— é”ï¼‰</td></tr><tr><td><strong><code class="language-plaintext highlighter-rouge">LinkedBlockingQueue</code></strong></td><td>é“¾è¡¨</td><td>ReentrantLockï¼ˆput/take ä¸¤æŠŠé”ï¼‰é•¿åº¦ä¸å¯ä¸º0</td></tr><tr><td><strong><code class="language-plaintext highlighter-rouge">ArrayBlockingQueue</code></strong></td><td>æ•°ç»„ç¯å½¢ç¼“å†²åŒº</td><td>ReentrantLockï¼ˆput/take ä¸¤æŠŠé”ï¼‰ æ˜¯æœ‰ç•Œçš„ï¼Œåˆå§‹åŒ–éœ€è¦æä¾›æ•°é‡</td></tr><tr><td><code class="language-plaintext highlighter-rouge">PriorityBlockingQueue</code></td><td>æœ€å°å †</td><td>ReentrantLock</td></tr><tr><td><strong><code class="language-plaintext highlighter-rouge">DelayQueue</code></strong></td><td>æœ€å°å †ï¼ˆå†…éƒ¨æ˜¯ PriorityQueueï¼‰</td><td>ReentrantLock</td></tr><tr><td><strong><code class="language-plaintext highlighter-rouge">SynchronousQueue</code></strong></td><td>æ— ç¼“å†²/è™šæ‹Ÿé˜Ÿåˆ—</td><td>CAS + Lockï¼ˆå…¬å¹³æ—¶ï¼‰</td></tr><tr><td><code class="language-plaintext highlighter-rouge">LinkedTransferQueue</code></td><td>é“¾è¡¨ + åŒ¹é…èŠ‚ç‚¹</td><td>CAS + è‡ªæ—‹</td></tr><tr><td><code class="language-plaintext highlighter-rouge">CopyOnWriteArrayList</code></td><td>æ•°ç»„</td><td>å†™æ—¶å¤åˆ¶</td></tr><tr><td><code class="language-plaintext highlighter-rouge">CopyOnWriteArraySet</code></td><td>åŸºäº <code class="language-plaintext highlighter-rouge">CopyOnWriteArrayList</code></td><td>å†™æ—¶å¤åˆ¶</td></tr></tbody></table><h3 id="linkedblockingqueue">LinkedBlockingQueue</h3><p><code class="language-plaintext highlighter-rouge">LinkedBlockingQueue</code> æ˜¯åŸºäº <strong>é“¾è¡¨</strong> å®ç°çš„ï¼Œå¹¶é€šè¿‡ <strong><code class="language-plaintext highlighter-rouge">ReentrantLock</code></strong> è¿›è¡ŒåŒæ­¥ç®¡ç†ã€‚å®ƒä½¿ç”¨ä¸¤æŠŠé”ï¼šä¸€æŠŠç”¨äºç”Ÿäº§è€…çº¿ç¨‹ï¼ˆ<code class="language-plaintext highlighter-rouge">put</code> æ“ä½œï¼‰ï¼Œä¸€æŠŠç”¨äºæ¶ˆè´¹è€…çº¿ç¨‹ï¼ˆ<code class="language-plaintext highlighter-rouge">take</code> æ“ä½œï¼‰ã€‚è¿™æ ·è®¾è®¡ä¿è¯äº† <code class="language-plaintext highlighter-rouge">put</code> å’Œ <code class="language-plaintext highlighter-rouge">take</code> æ“ä½œå¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œæé«˜äº†ååé‡ã€‚</p><ul><li><code class="language-plaintext highlighter-rouge">head</code> å’Œ <code class="language-plaintext highlighter-rouge">tail</code>ï¼šé“¾è¡¨çš„å¤´éƒ¨å’Œå°¾éƒ¨èŠ‚ç‚¹ã€‚</li><li><code class="language-plaintext highlighter-rouge">count</code>ï¼šé˜Ÿåˆ—ä¸­çš„å½“å‰å…ƒç´ æ•°é‡ã€‚</li><li><code class="language-plaintext highlighter-rouge">putLock</code>ï¼šç”¨äºæ§åˆ¶ <code class="language-plaintext highlighter-rouge">put</code> æ“ä½œçš„é”ã€‚</li><li><code class="language-plaintext highlighter-rouge">takeLock</code>ï¼šç”¨äºæ§åˆ¶ <code class="language-plaintext highlighter-rouge">take</code> æ“ä½œçš„é”ã€‚</li><li><code class="language-plaintext highlighter-rouge">notFull</code> å’Œ <code class="language-plaintext highlighter-rouge">notEmpty</code>ï¼šåˆ†åˆ«æ§åˆ¶å½“é˜Ÿåˆ—æ»¡æ—¶ç”Ÿäº§è€…çº¿ç¨‹çš„ç­‰å¾…å’Œå½“é˜Ÿåˆ—ç©ºæ—¶æ¶ˆè´¹è€…çº¿ç¨‹çš„ç­‰å¾…ã€‚</li></ul><div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">public</span> <span class="n">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">E</span> <span class="n">e</span><span class="o">)</span> <span class="n">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
    <span class="k">final</span> <span class="nc">ReentrantLock</span> <span class="n">putLock</span> <span class="k">=</span> <span class="k">this</span><span class="o">.</span><span class="py">putLock</span><span class="o">;</span>
    <span class="nv">putLock</span><span class="o">.</span><span class="py">lockInterruptibly</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="nf">while</span> <span class="o">(</span><span class="n">count</span> <span class="o">==</span> <span class="nv">items</span><span class="o">.</span><span class="py">length</span><span class="o">)</span>   <span class="c1">// å½“é˜Ÿåˆ—æ»¡æ—¶</span>
            <span class="nv">notFull</span><span class="o">.</span><span class="py">await</span><span class="o">();</span>             <span class="c1">// ç­‰å¾…é˜Ÿåˆ—æœ‰ç©ºé—´</span>
        <span class="nf">enqueue</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>                      <span class="c1">// æ’å…¥é˜Ÿåˆ—</span>
        <span class="nf">if</span> <span class="o">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span>                  <span class="c1">// å”¤é†’ç­‰å¾…çš„æ¶ˆè´¹è€…</span>
            <span class="nv">notEmpty</span><span class="o">.</span><span class="py">signal</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
        <span class="nv">putLock</span><span class="o">.</span><span class="py">unlock</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div><p><strong>åŒé”æœºåˆ¶ï¼ˆ<code class="language-plaintext highlighter-rouge">putLock</code> å’Œ <code class="language-plaintext highlighter-rouge">takeLock</code>ï¼‰</strong></p><ul><li><strong><code class="language-plaintext highlighter-rouge">putLock</code></strong>ï¼šæ§åˆ¶ <code class="language-plaintext highlighter-rouge">put</code> æ“ä½œï¼Œä¿è¯åœ¨æ’å…¥æ—¶ä¸ä¼šä¸ <code class="language-plaintext highlighter-rouge">take</code> æ“ä½œå†²çªã€‚</li><li><strong><code class="language-plaintext highlighter-rouge">takeLock</code></strong>ï¼šæ§åˆ¶ <code class="language-plaintext highlighter-rouge">take</code> æ“ä½œï¼Œä¿è¯åœ¨ç§»é™¤æ—¶ä¸ä¼šä¸ <code class="language-plaintext highlighter-rouge">put</code> æ“ä½œå†²çªã€‚</li></ul><p><strong>æ¡ä»¶å˜é‡ï¼ˆ<code class="language-plaintext highlighter-rouge">notFull</code> å’Œ <code class="language-plaintext highlighter-rouge">notEmpty</code>ï¼‰</strong></p><ul><li><strong><code class="language-plaintext highlighter-rouge">notFull</code></strong>ï¼šå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œç”Ÿäº§è€…çº¿ç¨‹ä¼šé˜»å¡åœ¨è¯¥æ¡ä»¶å˜é‡ä¸Šï¼Œç›´åˆ°é˜Ÿåˆ—æœ‰ç©ºé—´ã€‚</li><li><strong><code class="language-plaintext highlighter-rouge">notEmpty</code></strong>ï¼šå½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä¼šé˜»å¡åœ¨è¯¥æ¡ä»¶å˜é‡ä¸Šï¼Œç›´åˆ°é˜Ÿåˆ—æœ‰å…ƒç´ ã€‚</li></ul><h3 id="synchronousqueue">SynchronousQueue</h3><h4 id="åº•å±‚æ•°æ®ç»“æ„">åº•å±‚æ•°æ®ç»“æ„</h4><p><code class="language-plaintext highlighter-rouge">SynchronousQueue</code> çš„åº•å±‚å®ç°å¹¶ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„åŸºäº <strong>æ•°ç»„</strong> æˆ– <strong>é“¾è¡¨</strong> çš„æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯é€šè¿‡ <strong>åŒå‘é“¾è¡¨</strong> å’Œ <strong>é˜»å¡é˜Ÿåˆ—</strong> çš„æœºåˆ¶æ¥å®ç°å…ƒç´ çš„äº¤æ¢ã€‚</p><ol><li><p><strong>èŠ‚ç‚¹ï¼ˆNodeï¼‰</strong>ï¼š <code class="language-plaintext highlighter-rouge">SynchronousQueue</code> ä¸­ç»´æŠ¤äº†ä¸¤ä¸ªèŠ‚ç‚¹ï¼š</p><ul><li>ä¸€ä¸ªç”¨äºç­‰å¾…ç”Ÿäº§è€…çº¿ç¨‹ <code class="language-plaintext highlighter-rouge">put</code> æ•°æ®çš„èŠ‚ç‚¹ã€‚</li><li>ä¸€ä¸ªç”¨äºç­‰å¾…æ¶ˆè´¹è€…çº¿ç¨‹ <code class="language-plaintext highlighter-rouge">take</code> æ•°æ®çš„èŠ‚ç‚¹ã€‚</li></ul></li><li><p><strong>åŒæ­¥åŒå‘é“¾è¡¨</strong>ï¼š <code class="language-plaintext highlighter-rouge">SynchronousQueue</code> å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨åªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼š</p><ul><li>ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ç”Ÿäº§è€…çº¿ç¨‹åœ¨ <code class="language-plaintext highlighter-rouge">put</code> æ“ä½œæ—¶ç­‰å¾…çš„æ•°æ®ã€‚</li><li>å¦ä¸€ä¸ªèŠ‚ç‚¹æ˜¯æ¶ˆè´¹è€…çº¿ç¨‹åœ¨ <code class="language-plaintext highlighter-rouge">take</code> æ“ä½œæ—¶ç­‰å¾…çš„æ•°æ®ã€‚</li></ul><p>åŒå‘é“¾è¡¨çš„ä½œç”¨æ˜¯å¸®åŠ©ç®¡ç†ç­‰å¾…çš„çº¿ç¨‹ã€‚ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹çš„äº¤æ¢å°±æ˜¯é€šè¿‡è¿™ä¸¤ä¸ªèŠ‚ç‚¹æ¥å®ç°çš„ã€‚</p></li><li><p><strong>é”ä¸æ¡ä»¶å˜é‡</strong>ï¼š <code class="language-plaintext highlighter-rouge">SynchronousQueue</code> ä½¿ç”¨äº† <strong><code class="language-plaintext highlighter-rouge">ReentrantLock</code></strong> å’Œ <strong><code class="language-plaintext highlighter-rouge">Condition</code></strong> æ¥å®ç°çº¿ç¨‹åŒæ­¥å’Œç­‰å¾…ã€‚ç”Ÿäº§è€…çº¿ç¨‹åœ¨ <code class="language-plaintext highlighter-rouge">put</code> æ•°æ®æ—¶ä¼šæŒæœ‰é”å¹¶ç­‰å¾…ï¼Œå¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…çº¿ç¨‹ <code class="language-plaintext highlighter-rouge">take</code> æ•°æ®ï¼Œç”Ÿäº§è€…çº¿ç¨‹ä¼šé˜»å¡ã€‚æ¶ˆè´¹è€…çº¿ç¨‹åœ¨ <code class="language-plaintext highlighter-rouge">take</code> æ•°æ®æ—¶ä¹Ÿä¼šæŒæœ‰é”å¹¶ç­‰å¾…ï¼Œå¦‚æœæ²¡æœ‰ç”Ÿäº§è€…çº¿ç¨‹ <code class="language-plaintext highlighter-rouge">put</code> æ•°æ®ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä¼šé˜»å¡ã€‚</p></li></ol><h4 id="æ ¸å¿ƒæ–¹æ³•">æ ¸å¿ƒæ–¹æ³•</h4><ul><li><strong><code class="language-plaintext highlighter-rouge">put(E e)</code></strong>ï¼šå½“ç”Ÿäº§è€…è°ƒç”¨ <code class="language-plaintext highlighter-rouge">put</code> æ–¹æ³•æ—¶ï¼Œå®ƒä¼šå°è¯•å°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—ã€‚ç”±äº <code class="language-plaintext highlighter-rouge">SynchronousQueue</code> æ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…çº¿ç¨‹å¿…é¡»ç­‰å¾…æ¶ˆè´¹è€…çº¿ç¨‹è°ƒç”¨ <code class="language-plaintext highlighter-rouge">take</code> æ¥å–èµ°è¿™ä¸ªæ•°æ®ã€‚å¦‚æœæ¶ˆè´¹è€…çº¿ç¨‹æ²¡æœ‰å–èµ°æ•°æ®ï¼Œç”Ÿäº§è€…çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚</li><li><strong><code class="language-plaintext highlighter-rouge">take()</code></strong>ï¼šæ¶ˆè´¹è€…çº¿ç¨‹è°ƒç”¨ <code class="language-plaintext highlighter-rouge">take</code> æ–¹æ³•æ—¶ï¼Œå®ƒä¼šç­‰å¾…ç”Ÿäº§è€…çº¿ç¨‹å°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—ã€‚å¦‚æœç”Ÿäº§è€…çº¿ç¨‹æ²¡æœ‰æ”¾å…¥æ•°æ®ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚</li></ul><div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">SynchronousQueue</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SynchronousQueue</span><span class="o">&lt;&gt;();</span>

<span class="n">put</span><span class="o">,</span> <span class="n">take</span>
</code></pre></div></div><h3 id="delayqueue">DelayQueue</h3><p>DelayQueueä¸€èˆ¬ç”¨äºç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ã€‚</p><p>å®ƒä¸æ˜¯å®šæ—¶ä»»åŠ¡ã€‚</p><p><strong><code class="language-plaintext highlighter-rouge">take()</code></strong>ï¼šé˜»å¡åœ°è·å–é˜Ÿåˆ—ä¸­çš„å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œæˆ–è€…æ‰€æœ‰å…ƒç´ éƒ½å°šæœªåˆ°æœŸï¼Œè°ƒç”¨çº¿ç¨‹ä¼šè¢«é˜»å¡ç›´åˆ°æœ‰å…ƒç´ å¯ç”¨ã€‚</p><p><code class="language-plaintext highlighter-rouge">DelayQueue</code> çš„æ ¸å¿ƒæ˜¯åŸºäº <strong>ä¼˜å…ˆçº§é˜Ÿåˆ—</strong> æ¥è¿›è¡Œå…ƒç´ æ’åºï¼Œå…·ä½“æ¥è¯´ï¼Œå®ƒæ˜¯é€šè¿‡ <code class="language-plaintext highlighter-rouge">PriorityBlockingQueue</code> æ¥å®ç°çš„ã€‚<code class="language-plaintext highlighter-rouge">PriorityBlockingQueue</code> æ˜¯ä¸€ä¸ªæ²¡æœ‰å®¹é‡é™åˆ¶çš„é˜»å¡é˜Ÿåˆ—ï¼Œèƒ½å¤Ÿæ ¹æ®å…ƒç´ çš„å»¶è¿Ÿæ—¶é—´æ¥å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</p><ul><li><strong>é˜»å¡æœºåˆ¶</strong>ï¼š<code class="language-plaintext highlighter-rouge">take()</code> å’Œ <code class="language-plaintext highlighter-rouge">poll()</code> æ–¹æ³•ä¼šæ£€æŸ¥é˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ çš„å»¶è¿Ÿæ—¶é—´ã€‚å¦‚æœå»¶è¿Ÿæ—¶é—´æœªåˆ°ï¼Œè°ƒç”¨çº¿ç¨‹ä¼šè¢«é˜»å¡ç›´åˆ°å»¶è¿Ÿæ—¶é—´åˆ°æœŸã€‚</li><li><strong>çº¿ç¨‹é˜»å¡ä¸å”¤é†’</strong>ï¼š<code class="language-plaintext highlighter-rouge">DelayQueue</code> ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">AQS</code>ï¼ˆAbstractQueuedSynchronizerï¼‰æ¥ç®¡ç†é˜»å¡çº¿ç¨‹ã€‚å½“é˜Ÿåˆ—ä¸­çš„å…ƒç´ åˆ°æœŸæ—¶ï¼Œå®ƒä¼šå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼Œä½¿å¾—è¿™äº›çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</li></ul><h2 id="aqsåŸç†">AQSåŸç†</h2><blockquote><p>AQSï¼ˆAbstractQueuedSynchronizerï¼‰çš„åŸç†ã€‚å®ƒæ˜¯ Java å¹¶å‘æ¡†æ¶ä¸­ç”¨äºæ„å»ºé”å’ŒåŒæ­¥å™¨çš„ä¸€ä¸ªæ ¸å¿ƒæ¡†æ¶ç±»ï¼Œæ¯”å¦‚ ReentrantLockã€Semaphoreã€CountDownLatch ç­‰åŒæ­¥å™¨ï¼Œåº•å±‚éƒ½æ˜¯åŸºäº AQS å®ç°çš„ã€‚æ˜¯ Java å¹¶å‘åŒ… <code class="language-plaintext highlighter-rouge">java.util.concurrent.locks</code> ä¸­ç”¨æ¥æ„å»ºé”å’Œå…¶ä»–åŒæ­¥å™¨ï¼ˆå¦‚ä¿¡å·é‡ã€è¯»å†™é”ã€å€’è®¡æ—¶å™¨ç­‰ï¼‰çš„ä¸€ä¸ª<strong>åŸºç¡€æ¡†æ¶ç±»</strong>ã€‚å®ƒæ˜¯ J.U.C å¹¶å‘æ¡†æ¶ä¸­æœ€æ ¸å¿ƒçš„åº•å±‚ç»„ä»¶ä¹‹ä¸€ã€‚</p></blockquote><p>AQS é€šè¿‡ä¸€ä¸ª<strong>FIFO é˜Ÿåˆ—</strong>ï¼ˆå…ˆè¿›å…ˆå‡ºç­‰å¾…é˜Ÿåˆ—ï¼‰æ¥<strong>ç®¡ç†è·å–é”å¤±è´¥çš„çº¿ç¨‹</strong>ï¼Œå¹¶é€šè¿‡ä¸€ä¸ª<strong>åŸå­å˜é‡ state</strong> æ¥<strong>è¡¨ç¤ºåŒæ­¥çŠ¶æ€</strong>ï¼Œä»è€Œå®ç°å„ç§è‡ªå®šä¹‰åŒæ­¥å™¨ã€‚</p><h3 id="aqs-ä¸-synchronized-æœ‰ä½•ä¸åŒ">AQS ä¸ synchronized æœ‰ä½•ä¸åŒï¼Ÿ</h3><table><thead><tr><th>ç‰¹æ€§</th><th>synchronized</th><th>AQSï¼ˆå¦‚ ReentrantLockï¼‰</th></tr></thead><tbody><tr><td>å¯ä¸­æ–­</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td>å¯é‡å…¥</td><td>âœ…</td><td>âœ…</td></tr><tr><td>å…¬å¹³æ€§é€‰æ‹©</td><td>âŒ ä¸å¯é€‰</td><td>âœ… åªæœ‰æ”¯æŒå…¬å¹³æ¨¡å¼</td></tr><tr><td>æ¡ä»¶å˜é‡æ”¯æŒ</td><td>âŒ</td><td>âœ… Condition æ”¯æŒæ›´å¼ºå¤§</td></tr><tr><td>æ€§èƒ½æ§åˆ¶</td><td>âŒï¼ˆé»‘ç›’ï¼‰</td><td>âœ… æ›´å¯æ§</td></tr></tbody></table><p>å¦‚æœæƒ³è¦éFIFOï¼Œè¯·ç”¨synchronized, æ¯”å¦‚é‡å…¥é”éå…¬å¹³æ¨¡å¼ã€‚</p><h3 id="å®ç°">å®ç°</h3><h4 id="-1-æ ¸å¿ƒæ€æƒ³çŠ¶æ€--é˜Ÿåˆ—">ğŸŒŸ 1. æ ¸å¿ƒæ€æƒ³ï¼šçŠ¶æ€ + é˜Ÿåˆ—</h4><p>AQS çš„æ ¸å¿ƒæ˜¯ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><strong>state</strong>ï¼šä¸€ä¸ª <code class="language-plaintext highlighter-rouge">volatile int state</code> è¡¨ç¤ºå½“å‰çš„åŒæ­¥çŠ¶æ€ï¼Œæ¯”å¦‚ 0 è¡¨ç¤ºæœªåŠ é”ï¼Œ1 è¡¨ç¤ºå·²åŠ é”ã€‚</li><li><strong>ç­‰å¾…é˜Ÿåˆ—ï¼ˆCLH é˜Ÿåˆ—ï¼‰</strong>ï¼šçº¿ç¨‹è·å–é”å¤±è´¥åï¼Œä¼šè¢«å°è£…ä¸ºä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Node</code> èŠ‚ç‚¹ï¼ŒåŠ å…¥åˆ°ä¸€ä¸ª <strong>FIFO åŒå‘é˜Ÿåˆ—</strong> ä¸­ï¼Œå¹¶é€šè¿‡ <code class="language-plaintext highlighter-rouge">LockSupport.park()</code> æŒ‚èµ·ã€‚</li></ul><table><thead><tr><th>å­—æ®µå</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code class="language-plaintext highlighter-rouge">state</code></td><td><code class="language-plaintext highlighter-rouge">volatile int</code></td><td>åŒæ­¥çŠ¶æ€ï¼ˆ0 ä»£è¡¨æœªå ç”¨ï¼‰</td></tr><tr><td><code class="language-plaintext highlighter-rouge">head</code> / <code class="language-plaintext highlighter-rouge">tail</code></td><td><code class="language-plaintext highlighter-rouge">Node</code></td><td>CLH é˜Ÿåˆ—çš„å¤´å°¾æŒ‡é’ˆ</td></tr><tr><td><code class="language-plaintext highlighter-rouge">Node</code></td><td>é™æ€å†…éƒ¨ç±»</td><td>æ¯ä¸ªç­‰å¾…çº¿ç¨‹ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Node</code></td></tr><tr><td><code class="language-plaintext highlighter-rouge">waitStatus</code></td><td>int</td><td>èŠ‚ç‚¹çŠ¶æ€ï¼ˆSIGNALã€CANCELLED ç­‰ï¼‰</td></tr><tr><td><code class="language-plaintext highlighter-rouge">thread</code></td><td>Thread</td><td>å¯¹åº”çº¿ç¨‹</td></tr><tr><td><code class="language-plaintext highlighter-rouge">next</code> / <code class="language-plaintext highlighter-rouge">prev</code></td><td>Node</td><td>æŒ‡å‘å‰åèŠ‚ç‚¹ï¼Œå®ç°åŒå‘é“¾è¡¨</td></tr></tbody></table><h4 id="-2-è·å–é”æµç¨‹ä»¥ç‹¬å ä¸ºä¾‹">ğŸ” 2. è·å–é”æµç¨‹ï¼ˆä»¥ç‹¬å ä¸ºä¾‹ï¼‰ï¼š</h4><ul><li>çº¿ç¨‹è°ƒç”¨ <code class="language-plaintext highlighter-rouge">acquire()</code> å°è¯•åŠ é”ï¼Œåº•å±‚ä¼šè°ƒç”¨ <code class="language-plaintext highlighter-rouge">tryAcquire()</code>ã€‚</li><li>å¦‚æœ <code class="language-plaintext highlighter-rouge">tryAcquire()</code> å¤±è´¥ï¼Œå°±è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå¹¶é˜»å¡å½“å‰çº¿ç¨‹ã€‚</li><li>å‰ä¸€ä¸ªçº¿ç¨‹é‡Šæ”¾é”æ—¶è°ƒç”¨ <code class="language-plaintext highlighter-rouge">release()</code>ï¼Œåº•å±‚è°ƒç”¨ <code class="language-plaintext highlighter-rouge">tryRelease()</code> æˆåŠŸåå”¤é†’ä¸‹ä¸€ä¸ªçº¿ç¨‹ã€‚</li></ul><h4 id="-3-aqs-æä¾›æ¨¡æ¿æ–¹æ³•å­ç±»è´Ÿè´£å®ç°">ğŸ§± 3. AQS æä¾›æ¨¡æ¿æ–¹æ³•ï¼Œå­ç±»è´Ÿè´£å®ç°ï¼š</h4><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
protected boolean tryAcquire(int arg);
protected boolean tryRelease(int arg);
</code></pre></div></div><p>å¼€å‘è€…é€šè¿‡ç»§æ‰¿ AQS å¹¶å®ç°è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥è‡ªå®šä¹‰åŒæ­¥å™¨çš„è¡Œä¸ºã€‚</p><h4 id="-4-æ”¯æŒä¸¤ç§æ¨¡å¼">ğŸ“Œ 4. æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š</h4><ul><li><strong>ç‹¬å æ¨¡å¼ï¼ˆExclusiveï¼‰</strong>ï¼šä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è·å–èµ„æºï¼Œå¦‚ ReentrantLockã€‚<strong>tryAcquire</strong></li><li><strong>å…±äº«æ¨¡å¼ï¼ˆSharedï¼‰</strong>ï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«èµ„æºï¼Œå¦‚ Semaphoreã€CountDownLatchã€‚<strong>tryAcquireShared</strong></li></ul><div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">tryAcquire</span><span class="o">()</span> <span class="o">/</span> <span class="nf">tryAcquireShared</span><span class="o">()</span>
        <span class="o">â†“</span>
<span class="n">è·å–å¤±è´¥</span> <span class="o">â†’</span> <span class="nf">addWaiter</span><span class="o">()</span> <span class="o">â†’</span> <span class="nf">enq</span><span class="o">()</span> <span class="o">â†’</span> <span class="nf">park</span><span class="o">()</span>
        <span class="o">â†“</span>
<span class="n">å‰é©±é‡Šæ”¾é”</span> <span class="o">â†’</span> <span class="nf">unpark</span><span class="o">()</span> <span class="o">â†’</span> <span class="n">è‡ªæ—‹é‡è¯•</span> <span class="o">â†’</span> <span class="n">è·å–æˆåŠŸ</span>

</code></pre></div></div><h4 id="-5-å®é™…åº”ç”¨ä¸¾ä¾‹">ğŸ“š 5. å®é™…åº”ç”¨ä¸¾ä¾‹ï¼š</h4><ul><li>ReentrantLockï¼šåŸºäº AQS çš„ç‹¬å æ¨¡å¼ã€‚</li><li>Semaphoreï¼šåŸºäºå…±äº«æ¨¡å¼æ§åˆ¶å¹¶å‘æ•°é‡ã€‚</li><li>CountDownLatchï¼šé€šè¿‡å…±äº«è®¡æ•°æ§åˆ¶çº¿ç¨‹ç­‰å¾…ã€‚</li></ul><table><thead><tr><th>å­ç±»</th><th>æ¨¡å¼</th><th>å®ç°æ–¹æ³•</th></tr></thead><tbody><tr><td><code class="language-plaintext highlighter-rouge">ReentrantLock</code></td><td>ç‹¬å </td><td><code class="language-plaintext highlighter-rouge">tryAcquire</code>, <code class="language-plaintext highlighter-rouge">tryRelease</code></td></tr><tr><td><code class="language-plaintext highlighter-rouge">Semaphore</code></td><td>å…±äº«</td><td><code class="language-plaintext highlighter-rouge">tryAcquireShared</code>, <code class="language-plaintext highlighter-rouge">tryReleaseShared</code></td></tr><tr><td><code class="language-plaintext highlighter-rouge">CountDownLatch</code></td><td>å…±äº«</td><td><code class="language-plaintext highlighter-rouge">tryAcquireShared</code>, <code class="language-plaintext highlighter-rouge">tryReleaseShared</code></td></tr><tr><td><code class="language-plaintext highlighter-rouge">ReentrantReadWriteLock.WriteLock</code></td><td>ç‹¬å </td><td>è§å†™é”å®ç°</td></tr><tr><td><code class="language-plaintext highlighter-rouge">ReentrantReadWriteLock.ReadLock</code></td><td>å…±äº«</td><td>è§è¯»é”å®ç°</td></tr></tbody></table><p>ReentrantReadWriteLock è¯»å…±äº«ï¼Œå†™ç‹¬å </p><h3 id="qa">QA</h3><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ LockSupport.park() è€Œä¸æ˜¯ wait()ï¼Ÿ</p><ul><li><code class="language-plaintext highlighter-rouge">park/unpark</code> æ›´çµæ´»ï¼Œçº¿ç¨‹ä¸éœ€è¦å…ˆè·å–é”ã€‚</li><li><code class="language-plaintext highlighter-rouge">wait/notify</code> ä¾èµ–å¯¹è±¡é”ï¼Œå®¹æ˜“äº§ç”Ÿæ­»é”æˆ–å¤æ‚åŒæ­¥ã€‚</li></ul><p><strong>CLHï¼ˆCraig, Landin, and Hagerstenï¼‰é˜Ÿåˆ—</strong> æ˜¯æ ¸å¿ƒçš„æ•°æ®ç»“æ„ä¹‹ä¸€ã€‚å®ƒæ˜¯ä¸€ç§ç”¨äºå®ç° <strong>è‡ªæ—‹é” / é˜»å¡é”çš„å¹¶å‘é˜Ÿåˆ—</strong>ã€‚</p><ul><li>æ¯ä¸ªçº¿ç¨‹éƒ½å¯¹åº”ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆ<code class="language-plaintext highlighter-rouge">Node</code>ï¼‰æŒ‚åˆ°é˜Ÿåˆ—å°¾éƒ¨ã€‚</li><li>çº¿ç¨‹é€šè¿‡è‡ªæ—‹æˆ–æŒ‚èµ·ç­‰å¾…å…¶å‰é©±èŠ‚ç‚¹çš„çŠ¶æ€å˜åŒ–ã€‚</li><li>åœ¨ AQS ä¸­ç§°ä¸º <strong>â€œåŒæ­¥é˜Ÿåˆ—â€ï¼ˆsync queueï¼‰</strong>ã€‚</li></ul><p>ä¼˜ç‚¹</p><ul><li><strong>FIFO ä¿è¯å…¬å¹³æ€§</strong></li><li><strong>éé˜»å¡å…¥é˜Ÿï¼ˆCASï¼‰</strong></li><li><strong>è‡ªæ—‹/æŒ‚èµ·ç­‰å¾…å‰é©±é€šçŸ¥</strong></li><li><strong>å¯æ‰©å±•æ€§å¼ºï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯</strong></li></ul><h2 id="çº¿ç¨‹æ± ">çº¿ç¨‹æ± </h2><p>åˆç†åˆ©ç”¨çº¿ç¨‹æ± èƒ½å¤Ÿå¸¦æ¥ä¸‰ä¸ªå¥½å¤„ã€‚ç¬¬ä¸€ï¼šé™ä½èµ„æºæ¶ˆè€—ã€‚é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚ç¬¬äºŒï¼šæé«˜å“åº”é€Ÿåº¦ã€‚å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦çš„ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚ç¬¬ä¸‰ï¼šæé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ã€‚çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚ä½†æ˜¯è¦åšåˆ°åˆç†çš„åˆ©ç”¨çº¿ç¨‹æ± ï¼Œå¿…é¡»å¯¹å…¶åŸç†äº†å¦‚æŒ‡æŒã€‚</p><ul><li><code class="language-plaintext highlighter-rouge">Executors.newFixedThreadPool(int nThreads)</code>ï¼šåˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚</li><li><code class="language-plaintext highlighter-rouge">Executors.newCachedThreadPool()</code>ï¼šåˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± çš„å¤§å°å¯æ ¹æ®éœ€æ±‚åŠ¨æ€è°ƒæ•´ã€‚</li><li><code class="language-plaintext highlighter-rouge">Executors.newSingleThreadExecutor()</code>ï¼šåˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æäº¤é¡ºåºæ‰§è¡Œã€‚</li><li><code class="language-plaintext highlighter-rouge">Executors.newScheduledThreadPool(int corePoolSize)</code>ï¼šåˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼Œæ”¯æŒå®šæ—¶ä»»åŠ¡æ‰§è¡Œã€‚</li></ul><div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1">// åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼Œå¤§å°ä¸º 3</span>
        <span class="nc">ExecutorService</span> <span class="n">threadPool</span> <span class="k">=</span> <span class="nv">Executors</span><span class="o">.</span><span class="py">newFixedThreadPool</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>

        <span class="c1">// æäº¤ 6 ä¸ªä»»åŠ¡</span>
        <span class="nf">for</span> <span class="o">(</span><span class="n">int</span> <span class="n">i</span> <span class="k">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nv">threadPool</span><span class="o">.</span><span class="py">submit</span><span class="o">(</span><span class="k">new</span> <span class="nc">Task</span><span class="o">(</span><span class="s">"Task "</span> <span class="o">+</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)));</span>
        <span class="o">}</span>

        <span class="c1">// å…³é—­çº¿ç¨‹æ± </span>
        <span class="nv">threadPool</span><span class="o">.</span><span class="py">shutdown</span><span class="o">();</span>
</code></pre></div></div><h3 id="çº¿ç¨‹æ± ä»»åŠ¡åˆ›å»ºä¸æäº¤">çº¿ç¨‹æ± ä»»åŠ¡åˆ›å»ºä¸æäº¤</h3><p>ä»»åŠ¡åˆ†ä¸ºä¸¤ç§:ä¸€ç§æ˜¯æœ‰è¿”å›å€¼çš„ï¼ˆ callable ï¼‰ï¼Œä¸€ç§æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼ˆ runnable ï¼‰. Callable ä¸ Future ä¸¤åŠŸèƒ½æ˜¯ Java åœ¨åç»­ç‰ˆæœ¬ä¸­ä¸ºäº†é€‚åº”å¤šå¹¶æ³•æ‰åŠ å…¥çš„ï¼ŒCallable æ˜¯ç±»ä¼¼äº Runnable çš„æ¥å£ï¼Œå®ç° Callable æ¥å£çš„ç±»å’Œå®ç° Runnable çš„ç±»éƒ½æ˜¯å¯è¢«å…¶ä»–çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p><ol><li>æ— è¿”å›å€¼çš„ä»»åŠ¡å°±æ˜¯ä¸€ä¸ªå®ç°äº† runnable æ¥å£çš„ç±».ä½¿ç”¨ run æ–¹æ³•.</li><li>æœ‰è¿”å›å€¼çš„ä»»åŠ¡æ˜¯ä¸€ä¸ªå®ç°äº† callable æ¥å£çš„ç±».ä½¿ç”¨ call æ–¹æ³•.</li></ol><p>Callable å’Œ Runnable çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ol><li>Callable å®šä¹‰çš„æ–¹æ³•æ˜¯ callï¼Œè€Œ Runnable å®šä¹‰çš„æ–¹æ³•æ˜¯ runã€‚</li><li>Callable çš„ call æ–¹æ³•å¯ä»¥æœ‰è¿”å›å€¼ï¼Œè€Œ Runnable çš„ run æ–¹æ³•ä¸èƒ½æœ‰è¿”å›å€¼ã€‚</li><li>Callable çš„ call æ–¹æ³•å¯æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œ Runnable çš„ run æ–¹æ³•ä¸èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚</li></ol><p>execute ä¸ submit åŒºåˆ«ï¼š</p><ol><li>æ¥æ”¶çš„å‚æ•°ä¸ä¸€æ ·</li><li>submit æœ‰è¿”å›å€¼ï¼Œè€Œ execute æ²¡æœ‰</li><li>submit æ–¹ä¾¿ Exception å¤„ç†</li><li>execute æ˜¯ Executor æ¥å£ä¸­å”¯ä¸€å®šä¹‰çš„æ–¹æ³•ï¼›submit æ˜¯ ExecutorServiceï¼ˆè¯¥æ¥å£ç»§æ‰¿ Executorï¼‰ä¸­å®šä¹‰çš„æ–¹æ³•</li></ol><h3 id="çº¿ç¨‹æ± çš„å…³é—­">çº¿ç¨‹æ± çš„å…³é—­</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨çº¿ç¨‹æ± çš„ shutdown æˆ– shutdownNow æ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± ï¼Œä½†æ˜¯å®ƒä»¬çš„å®ç°åŸç†ä¸åŒï¼Œshutdown çš„åŸç†æ˜¯åªæ˜¯å°†çº¿ç¨‹æ± çš„çŠ¶æ€è®¾ç½®æˆ SHUTDOWN çŠ¶æ€ï¼Œç„¶åä¸­æ–­æ‰€æœ‰æ²¡æœ‰æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ã€‚shutdownNow çš„åŸç†æ˜¯éå†çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹ï¼Œç„¶åé€ä¸ªè°ƒç”¨çº¿ç¨‹çš„ <strong>interrupt</strong> æ–¹æ³•æ¥ä¸­æ–­çº¿ç¨‹ï¼Œæ‰€ä»¥æ— æ³•å“åº”ä¸­æ–­çš„ä»»åŠ¡å¯èƒ½æ°¸è¿œæ— æ³•ç»ˆæ­¢ã€‚shutdownNow ä¼šé¦–å…ˆå°†çº¿ç¨‹æ± çš„çŠ¶æ€è®¾ç½®æˆ STOPï¼Œç„¶åå°è¯•åœæ­¢æ‰€æœ‰çš„æ­£åœ¨æ‰§è¡Œæˆ–æš‚åœä»»åŠ¡çš„çº¿ç¨‹ï¼Œå¹¶è¿”å›ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„åˆ—è¡¨ã€‚</p><p>åªè¦è°ƒç”¨äº†è¿™ä¸¤ä¸ªå…³é—­æ–¹æ³•çš„å…¶ä¸­ä¸€ä¸ªï¼Œ<strong>isShutdown</strong> æ–¹æ³•å°±ä¼šè¿”å› trueã€‚å½“æ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²å…³é—­å,æ‰è¡¨ç¤ºçº¿ç¨‹æ± å…³é—­æˆåŠŸï¼Œè¿™æ—¶è°ƒç”¨ isTerminaed æ–¹æ³•ä¼šè¿”å› trueã€‚è‡³äºæˆ‘ä»¬åº”è¯¥è°ƒç”¨å“ªä¸€ç§æ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± ï¼Œåº”è¯¥ç”±æäº¤åˆ°çº¿ç¨‹æ± çš„ä»»åŠ¡ç‰¹æ€§å†³å®šï¼Œé€šå¸¸è°ƒç”¨ shutdown æ¥å…³é—­çº¿ç¨‹æ± ï¼Œå¦‚æœä»»åŠ¡ä¸ä¸€å®šè¦æ‰§è¡Œå®Œï¼Œåˆ™å¯ä»¥è°ƒç”¨ shutdownNowã€‚</p><h3 id="çº¿ç¨‹æ± çš„åˆ†æ">çº¿ç¨‹æ± çš„åˆ†æ</h3><p>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± éœ€è¦è¾“å…¥å‡ ä¸ªå‚æ•°ï¼š</p><ul><li><strong>corePoolSize</strong>ï¼ˆçº¿ç¨‹æ± çš„åŸºæœ¬å¤§å°ï¼‰ï¼šå½“æäº¤ä¸€ä¸ªä»»åŠ¡åˆ°çº¿ç¨‹æ± æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå³ä½¿å…¶ä»–ç©ºé—²çš„åŸºæœ¬çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œæ–°ä»»åŠ¡ä¹Ÿä¼šåˆ›å»ºçº¿ç¨‹ï¼Œç­‰åˆ°éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ•°å¤§äºçº¿ç¨‹æ± åŸºæœ¬å¤§å°æ—¶å°±ä¸å†åˆ›å»ºã€‚å¦‚æœè°ƒç”¨äº†çº¿ç¨‹æ± çš„ prestartAllCoreThreads æ–¹æ³•ï¼Œçº¿ç¨‹æ± ä¼šæå‰åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰åŸºæœ¬çº¿ç¨‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸º 0ï¼Œå½“æœ‰ä»»åŠ¡æ¥ä¹‹åï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ° corePoolSize åï¼Œå°±ä¼šæŠŠåˆ°è¾¾çš„ä»»åŠ¡æ”¾åˆ°ç¼“å­˜é˜Ÿåˆ—å½“ä¸­ï¼›</li><li><strong>runnableTaskQueue</strong>ï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰ï¼šç”¨äºä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚å¯ä»¥é€‰æ‹©ä»¥ä¸‹å‡ ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚</li></ul><ol><li>ArrayBlockingQueueï¼šæ˜¯ä¸€ä¸ªåŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</li><li>LinkedBlockingQueueï¼šä¸€ä¸ªåŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ­¤é˜Ÿåˆ—æŒ‰ FIFO ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ æ’åºå…ƒç´ ï¼Œååé‡é€šå¸¸è¦é«˜äº ArrayBlockingQueueã€‚é™æ€å·¥å‚æ–¹æ³• Executors.newFixedThreadPool()ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</li><li>SynchronousQueueï¼šä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äº LinkedBlockingQueueï¼Œé™æ€å·¥å‚æ–¹æ³• Executors.newCachedThreadPool ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚</li><li>PriorityBlockingQueueï¼šä¸€ä¸ªå…·æœ‰ä¼˜å…ˆçº§å¾—æ— é™é˜»å¡é˜Ÿåˆ—ã€‚</li></ol><ul><li>maximumPoolSizeï¼ˆçº¿ç¨‹æ± æœ€å¤§å¤§å°ï¼‰ï¼šçº¿ç¨‹æ± å…è®¸åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ã€‚å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™çº¿ç¨‹æ± ä¼šå†åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯å¦‚æœä½¿ç”¨äº†æ— ç•Œçš„ä»»åŠ¡é˜Ÿåˆ—è¿™ä¸ªå‚æ•°å°±æ²¡ä»€ä¹ˆæ•ˆæœã€‚ä¹Ÿå°±æ˜¯è¯´ corePoolSize å°±æ˜¯çº¿ç¨‹æ± å¤§å°ï¼ŒmaximumPoolSize åœ¨æˆ‘çœ‹æ¥æ˜¯çº¿ç¨‹æ± çš„ä¸€ç§è¡¥æ•‘æªæ–½ï¼Œå³ä»»åŠ¡é‡çªç„¶è¿‡å¤§æ—¶çš„ä¸€ç§è¡¥æ•‘æªæ–½ã€‚</li><li><strong>ThreadFactory</strong>ï¼šç”¨äºè®¾ç½®åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹å·¥å‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®æ›´æœ‰æ„ä¹‰çš„åå­—ï¼ŒDebug å’Œå®šä½é—®é¢˜æ—¶éå¸¸åˆå¸®åŠ©ã€‚</li><li><strong>RejectedExecutionHandler</strong>ï¼ˆé¥±å’Œç­–ç•¥ï¼‰ï¼šå½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†ï¼Œè¯´æ˜çº¿ç¨‹æ± å¤„äºé¥±å’ŒçŠ¶æ€ï¼Œé‚£ä¹ˆå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†æäº¤çš„æ–°ä»»åŠ¡ã€‚è¿™ä¸ªç­–ç•¥é»˜è®¤æƒ…å†µä¸‹æ˜¯ AbortPolicyï¼Œè¡¨ç¤ºæ— æ³•å¤„ç†æ–°ä»»åŠ¡æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚ä»¥ä¸‹æ˜¯ JDK1.5 æä¾›çš„å››ç§ç­–ç•¥ã€‚</li></ul><ol><li>AbortPolicyï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸</li><li>CallerRunsPolicyï¼šåªç”¨è°ƒç”¨è€…æ‰€åœ¨çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡ã€‚</li><li>DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—é‡Œæœ€è¿‘çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ã€‚</li><li>DiscardPolicyï¼šä¸å¤„ç†ï¼Œä¸¢å¼ƒæ‰ã€‚</li></ol><p>å½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®åº”ç”¨åœºæ™¯éœ€è¦æ¥å®ç° RejectedExecutionHandler æ¥å£è‡ªå®šä¹‰ç­–ç•¥ã€‚å¦‚è®°å½•æ—¥å¿—æˆ–æŒä¹…åŒ–ä¸èƒ½å¤„ç†çš„ä»»åŠ¡ã€‚</p><ul><li>keepAliveTimeï¼ˆçº¿ç¨‹æ´»åŠ¨ä¿æŒæ—¶é—´ï¼‰ï¼šçº¿ç¨‹æ± çš„å·¥ä½œçº¿ç¨‹ç©ºé—²åï¼Œä¿æŒå­˜æ´»çš„æ—¶é—´ã€‚æ‰€ä»¥å¦‚æœä»»åŠ¡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œå¯ä»¥è°ƒå¤§è¿™ä¸ªæ—¶é—´ï¼Œæé«˜çº¿ç¨‹çš„åˆ©ç”¨ç‡ã€‚</li><li>TimeUnitï¼ˆçº¿ç¨‹æ´»åŠ¨ä¿æŒæ—¶é—´çš„å•ä½ï¼‰ï¼šå¯é€‰çš„å•ä½æœ‰å¤©ï¼ˆDAYSï¼‰ï¼Œå°æ—¶ï¼ˆHOURSï¼‰ï¼Œåˆ†é’Ÿï¼ˆMINUTESï¼‰ï¼Œæ¯«ç§’(MILLISECONDS)ï¼Œå¾®ç§’(MICROSECONDS, åƒåˆ†ä¹‹ä¸€æ¯«ç§’)å’Œæ¯«å¾®ç§’(NANOSECONDS, åƒåˆ†ä¹‹ä¸€å¾®ç§’)ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/mafulong/mdPic@vv6/v6/202505041121762.jpeg" alt="" /></p><p>ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå½“æäº¤ä¸€ä¸ªæ–°ä»»åŠ¡åˆ°çº¿ç¨‹æ± æ—¶ï¼Œçº¿ç¨‹æ± çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®å°äº corePoolSizeï¼Œåˆ™æ¯æ¥ä¸€ä¸ªä»»åŠ¡ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼›</li><li>å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®&gt;=corePoolSizeï¼Œåˆ™æ¯æ¥ä¸€ä¸ªä»»åŠ¡ï¼Œä¼šå°è¯•å°†å…¶æ·»åŠ åˆ°ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å½“ä¸­ï¼Œè‹¥æ·»åŠ æˆåŠŸï¼Œåˆ™è¯¥ä»»åŠ¡ä¼šç­‰å¾…ç©ºé—²çº¿ç¨‹å°†å…¶å–å‡ºå»æ‰§è¡Œï¼›è‹¥æ·»åŠ å¤±è´¥ï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™ä¼šå°è¯•åˆ›å»ºæ–°çš„çº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼›</li><li>å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ° maximumPoolSizeï¼Œåˆ™ä¼šé‡‡å–ä»»åŠ¡æ‹’ç»ç­–ç•¥è¿›è¡Œå¤„ç†ï¼›</li></ol><p>å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº corePoolSize æ—¶ï¼Œå¦‚æœæŸçº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡ keepAliveTimeï¼Œçº¿ç¨‹å°†è¢«ç»ˆæ­¢ï¼Œç›´è‡³çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®ä¸å¤§äº corePoolSizeï¼›å¦‚æœå…è®¸ä¸ºæ ¸å¿ƒæ± ä¸­çš„çº¿ç¨‹è®¾ç½®å­˜æ´»æ—¶é—´ï¼Œé‚£ä¹ˆæ ¸å¿ƒæ± ä¸­çš„çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡ keepAliveTimeï¼Œçº¿ç¨‹ä¹Ÿä¼šè¢«ç»ˆæ­¢</p><p>ä»å®ƒä»¬çš„å…·ä½“å®ç°æ¥çœ‹ï¼Œå®ƒä»¬å®é™…ä¸Šä¹Ÿæ˜¯è°ƒç”¨äº† ThreadPoolExecutorï¼Œåªä¸è¿‡å‚æ•°éƒ½å·²é…ç½®å¥½äº†ã€‚</p><p><strong>newFixedThreadPool</strong> åˆ›å»ºçš„çº¿ç¨‹æ±  corePoolSize å’Œ maximumPoolSize å€¼æ˜¯ç›¸ç­‰çš„ï¼Œå®ƒä½¿ç”¨çš„ LinkedBlockingQueueï¼›</p><p><strong>newSingleThreadExecutor</strong> å°† corePoolSize å’Œ maximumPoolSize éƒ½è®¾ç½®ä¸º 1ï¼Œä¹Ÿä½¿ç”¨çš„ LinkedBlockingQueueï¼›</p><p><strong>newCachedThreadPool</strong> å°† corePoolSize è®¾ç½®ä¸º 0ï¼Œå°† maximumPoolSize è®¾ç½®ä¸º Integer.MAX_VALUEï¼Œä½¿ç”¨çš„ SynchronousQueueï¼Œä¹Ÿå°±æ˜¯è¯´æ¥äº†ä»»åŠ¡å°±åˆ›å»ºçº¿ç¨‹è¿è¡Œï¼Œå½“çº¿ç¨‹ç©ºé—²è¶…è¿‡ 60 ç§’ï¼Œå°±é”€æ¯çº¿ç¨‹ã€‚</p><p>å®é™…ä¸­ï¼Œå¦‚æœ Executors æä¾›çš„ä¸‰ä¸ªé™æ€æ–¹æ³•èƒ½æ»¡è¶³è¦æ±‚ï¼Œå°±å°½é‡ä½¿ç”¨å®ƒæä¾›çš„ä¸‰ä¸ªæ–¹æ³•ï¼Œå› ä¸ºè‡ªå·±å»æ‰‹åŠ¨é…ç½® ThreadPoolExecutor çš„å‚æ•°æœ‰ç‚¹éº»çƒ¦ï¼Œè¦æ ¹æ®å®é™…ä»»åŠ¡çš„ç±»å‹å’Œæ•°é‡æ¥è¿›è¡Œé…ç½®ã€‚å¦å¤–ï¼Œå¦‚æœ ThreadPoolExecutor è¾¾ä¸åˆ°è¦æ±‚ï¼Œå¯ä»¥è‡ªå·±ç»§æ‰¿ ThreadPoolExecutor ç±»è¿›è¡Œé‡å†™ã€‚</p></article><div class="share mobile-hidden"><div class="share-component"></div></div><div class="comment mobile-hidden"></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width: 96%" type="text" id="search_box" placeholder="Search" /></div><ul id="search_results" style=" font-size: 14px; list-style-type: none; padding-top: 10px; padding-left: 10px; " ></ul><script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/search_data.json', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 20, fuzzy: false, exclude: ['Welcome'] }); window.onload = function(){ var query_text = window.location.search.substring(1); var vars = query_text.split("&"); for (var i=0;i<vars.length;i++) { var pair = vars[i].split("="); if(pair[0] == "search_text"){ var query = pair[1]; query = decodeURI(query); var search = document.getElementById('search_box'); search.value = query; var event = new InputEvent('keyup'); search.dispatchEvent(event); break } } } </script><h3 class="post-directory-title">Table of Contents</h3><div id="post-directory-module"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/js/jquery.toc.js"></script><div class="mobile-hidden"><h3>Popular Posts</h3><ul><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2022/12/01/typescript%E7%AC%94%E8%AE%B0/">2022-12 typescriptç¬”è®°</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2022/08/16/scala%E8%AF%AD%E6%B3%95/">2022-08 scalaè¯­æ³•</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2021/12/26/etcd%E5%92%8Craft/">2021-12 etcdå’Œraft</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2021/09/08/%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9/">2021-09 çŠ¶æ€å‹ç¼©</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2021/01/25/%E5%8D%9A%E5%BC%88%E8%AE%BA/">2021-01 åšå¼ˆè®º</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2021/01/09/%E5%88%86%E5%B8%83%E5%BC%8F%E7%AE%97%E6%B3%95%E5%92%8C%E5%8D%8F%E8%AE%AE/">2021-01 åˆ†å¸ƒå¼ç®—æ³•å’Œåè®®</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2020/12/08/Kafka%E5%8E%9F%E7%90%861-%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84/">2020-12 kafkaåŸç†1-åŸºç¡€æ¶æ„</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2020/12/08/ElasticSearch/">2020-12 ElasticSearch(ES)åŸç†</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2020/11/29/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E6%80%BB%E7%BB%93/">2020-11 åŠ¨æ€è§„åˆ’æ€»ç»“</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2020/11/12/%E7%BA%BF%E6%AE%B5%E6%A0%91/">2020-11 çº¿æ®µæ ‘</a></h6><h6 class="repo-list-name font16px"> <a href="https://mafulong.github.io/2017/12/03/javascript%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">2017-12 javascriptç¬”è®°</a></h6></ul></div></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> Â© 2015 <span title="Fulong Ma">Fulong Ma</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="https://www.privacypolicygenerator.info/live.php?token=cnfKULv1VpqenfUs021YVA90fPiK75Cw">Privacy Policy</a></li><li> <a href="https://www.termsfeed.com/live/9dccd944-1b18-436d-bd12-3dd799b1282a">Terms </a></li><li> <a href="javascript:window.scrollTo(0,0)">TOP</a></li></ul><a href="https://github.com/mafulong/mafulong.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://mafulong.github.io/" title="Home" target="">Home</a></li><li> <a href="https://mafulong.github.io/categories/" title="Categories" target="">Categories</a></li><li> <a href="https://mafulong.github.io/archives/" title="Achieves" target="">Achieves</a></li><li> <a href="https://mafulong.github.io/open-source" title="Open-Source" target="">Open-Source</a></li><li> <a href="https://mafulong.github.io/bookmark" title="Bookmark" target="">Bookmark</a></li><li> <a href="https://mafulong.github.io/about" title="About" target="">About</a></li></ul><script async src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> æœ¬ç«™è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡ </span> <span id="busuanzi_container_site_uv" style="display:none"> / æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äºº </span></div></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="å›åˆ°é¡¶éƒ¨"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script> <script> $(document).ready(function() { $("td img").each(function() { var strA = "<a href='" + this.src + "' itemscope=\"\" itemtype=\"http://schema.org/ImageObject\" itemprop=\"url\" data-fancybox=\"default\" rel=\"default\"></a>"; $(this).wrapAll(strA); }); $("p img").each(function() { var strA = "<a href='" + this.src + "' itemscope=\"\" itemtype=\"http://schema.org/ImageObject\" itemprop=\"url\" data-fancybox=\"default\" rel=\"default\"></a>"; $(this).wrapAll(strA); }); }); </script> <script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/mafulong/mafulong.github.io@built/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function ($) { $('.geopattern').each(function () { $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script><div style="display:none"> <script async src="https://www.googletagmanager.com/gtag/js?id=G-SS4VDLWLNC"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() {dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SS4VDLWLNC'); </script></div></body></html>

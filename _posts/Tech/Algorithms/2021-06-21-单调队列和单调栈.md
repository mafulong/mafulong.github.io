---
layout: post
category: Algorithms
title: 单调队列和单调栈
tags: Algorithms
---

## 单调栈和单调队列

单调栈用于求下一个比它大或者比它小的。o(n)。 或者是左边最小的。

单调队列在此基础上可以筛选头部不要的元素。

当访问到第 i 个元素时，单调栈维护的区间为 [0, i) ，而单调队列维护的区间为 (last_pop, i)。因此单调队列可以做一些比如j-i<N的限制维护单调队列。



单调栈总结：**如果压栈之后仍然可以保持单调性，那么直接压。否则先弹出栈的元素，直到压入之后可以保持单调性。** 这个算法的原理用一句话总结就是，**被弹出的元素都是大于当前元素的，并且由于栈是单调增的，因此在其之后小于其本身的最近的就是当前元素了**



场景：

- 求左边/右边 第一个比a[i]大/小的值。 
- 求左边/右边 持续的a[i]<a[j]或者a[i]>a[j]的值。
- [求不重复的字典序字符串](https://leetcode-cn.com/problems/smallest-subsequence-of-distinct-characters/)
- [求A[i]<A[j]的最大j-i, 最大宽度坡](https://chengzhaoxi.xyz/cc968d26.html)

## 单调栈可利用的点

维护一个栈， 最终目的是把当前元素append进去，因此可能对pop一些元素，可利用的就是pop的这些元素，和最后插入元素这两个时机。

如果是递减栈，则插入过程中被Pop掉的都是小于当前i的值， 因此对于pop元素，求的是的右边第一个大，对i也知道左边第一个小。



- 因此求右边第一个大的，可以递减栈，从左往右遍历，弹出时操作。 也可以顺便求左边第一个大的，在push时操作。

- 求右边第一个小的，可以递增栈，从左往右遍历，弹出时操作。

- 求左边第一个大的，可以递减栈，从右往左遍历，弹出时操作。

- 求左边第一个小的，可以递增栈，从右往左遍历，弹出时操作。

  

模板：

求左右两边第一个小的：[84. 柱状图中最大的矩形](https://leetcode-cn.com/problems/largest-rectangle-in-histogram/)

```python
class Solution:
    def largestRectangleArea(self, heights: List[int]) -> int:
        if not heights:
            return 0
        n = len(heights)
        l = [-1 for _ in range(n)]
        r = [n for _ in range(n)]
        stack = []
        for i, h in enumerate(heights):
            while stack and heights[stack[-1]] >= h:
                r[stack[-1]] = i
                stack.pop()
            l[i] = stack[-1] if stack else -1
            stack.append(i)
        ans = max(h * (r[i] - l[i] - 1) for i, h in enumerate(heights))
        return ans

```

注意以上求法是非严格小的。 

下面是严格小的：![stackl-1Jl's sInallest.png](https://pic.leetcode-cn.com/1613007377-MVxZMC-stackl-1Jl's%20sInallest.png) 对于stack[-1]来说，[参考：](https://leetcode-cn.com/problems/sum-of-subarray-minimums/solution/python3-tong-84ti-zui-da-zhi-fang-tu-by-5ersw/)



相关题目：

- [力扣加加](https://leetcode-solution-leetcode-pp.gitbook.io/leetcode-solution/thinkings/monotone-stack)
- [1944. 队列中可以看到的人数](https://leetcode-cn.com/problems/number-of-visible-people-in-a-queue/) 统计右边连续A[i]<A[j]的数量。
- [84. 柱状图中最大的矩形](https://leetcode-cn.com/problems/largest-rectangle-in-histogram/) 计算左右两边第一个小的位置i,j, 然后用i,j就可以求出矩形面积了，可以一次遍历求出。
- [42. 接雨水](https://leetcode-cn.com/problems/trapping-rain-water/) 遍历到i, 求右边第一个比A[i]大的位置，就可以求出雨水大小了。
- [739. 每日温度](https://leetcode-cn.com/problems/daily-temperatures/)  求在每一天需要等几天才会有更高的温度。实际就是求下一个更大值的位置。
- [1081. 不同字符的最小子序列](https://leetcode-cn.com/problems/smallest-subsequence-of-distinct-characters/)  用递增栈维护子序列，遍历到i时， 当在栈里直接continue, 当栈顶的字符后面不会再出现时，不能pop。
- [求A[i]<A[j]的最大j-i, 最大宽度坡](https://chengzhaoxi.xyz/cc968d26.html) 维护有序数组或者按照大小对1,2,3,4...排序。
- [84. 柱状图中最大的矩形](https://leetcode-cn.com/problems/largest-rectangle-in-histogram/) 左右两边最小值索引。
- [85. 最大矩形](https://leetcode-cn.com/problems/maximal-rectangle/)  变成柱状图中最大矩形即可。
- [402. 移掉 K 位数字](https://leetcode-cn.com/problems/remove-k-digits/) 求移除这个数中的 `k` 位数字，使得剩下的数字最小


---
layout: post
category: Java
title: Java内存屏障
tags: SystemDesign
---

## 内存屏障

[参考](https://monkeysayhi.github.io/2017/12/28/%E4%B8%80%E6%96%87%E8%A7%A3%E5%86%B3%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C/)

内存屏障是硬件之上、操作系统或JVM之下，对并发作出的最后一层支持。再向下是是硬件提供的支持；向上是操作系统或JVM对内存屏障作出的各种封装。内存屏障是一种标准，各厂商可能采用不同的实现。



内存屏障的实现涉及大量硬件架构层面的知识，又需要操作系统或JVM的配合才能发挥威力，单纯从任何一个层面都无法理解。



volatile变量规则：**对volatile变量的写入操作必须在对该变量的读操作之前执行**。

volatile变量规则只是一种标准，要求JVM实现保证volatile变量的偏序语义。**结合程序顺序规则、传递性**，该偏序语义通常表现为两个作用：

- 保持可见性
- 禁用重排序（读操作禁止重排序之后的操作，写操作禁止重排序之前的操作）

通过**volatile标记，可以解决编译器层面的可见性与重排序问题**。而**内存屏障则解决了硬件层面的可见性与重排序问题**。


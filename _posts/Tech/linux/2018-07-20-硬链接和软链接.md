---
layout: post
category: Linux
title: linux硬链接和软链接的区别
tags: Linux
---

## 原理上：

硬链接(hard link)：A是B的硬链接（A和B都是文件名），则A和B指向了同一个inode。

即**一个inode节点对应两个不同的文件名，两个文件名指向同一个文件**，A和B对文件系统来说是完全平等的。如果删除了其中一个，对另外一个没有影响。每增加一个文件名，inode节点上的链接数增加一，每删除一个对应的文件名，inode节点上的链接数减一，直到为0，inode节点和对应的数据块被回收。注：文件和文件名是不同的东西，rm A删除的只是A这个文件名，而A对应的数据块（文件）只有在inode节点链接数减少为0的时候才会被系统回收。



软链接(soft link)：A是B的软链接（A和B都是文件名），A的目录项中的inode节点号与B的目录项中的inode节点号不相同，A和B指向的是两个不同的inode，继而指向两块不同的数据块。但是A的数据块中存放的只是B的路径名（可以根据这个找到B的目录项）。A和B之间是“主从”关系，如果B被删除了，A仍然存在（因为两个是不同的文件），但指向的是一个无效的链接。

**A的inode指向的数据块存了B的路径名，两个Inode不一样。**

## 使用限制上：

硬链接：

1. 不能对目录创建硬链接，原因有几种，最重要的是：文件系统不能存在链接环（目录创建时的".."除外，这个系统可以识别出来）,存在环的后果会导致例如文件遍历等操作的混乱(du，pwd等命令的运作原理就是基于文件硬链接，顺便一提，ls -l结果的第二列也是文件的硬链接数，即inode节点的链接数)
2. 不能对不同的文件系统创建硬链接,即两个文件名要在相同的文件系统下。
3. 不能对不存在的文件创建硬链接，由原理即可知原因。

软链接：

1. 可以对目录创建软链接，遍历操作会忽略目录的软链接。
2. 可以跨文件系统
3. 可以对不存在的文件创建软链接，因为放的只是一个字符串，至于这个字符串是不是对于一个实际的文件，就是另外一回事了

## 命令

硬：
- ln 源文件 链接名

软：

- ln -s 源文件 链接名
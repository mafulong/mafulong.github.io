---
layout: post
category: Web3
title: 区块链入门QA
tags: Web3

---

## 区块链入门QA

## 去中心化交易所

不同数字资产之间如果要进行兑换，需要经过交易所等中介渠道。

传统交易所是中心化模式，即交易双方通过第三方提供的交易平台按照汇率进行交换，交易平台方往往需要从交易中收取手续费用。这种模式下不仅成本高，而且存在对交易平台依赖过高的风险。

为了解决这些问题，去中心化交易所（Decentralized Exchange，DEX）被设计出来。其初步想法是通过基于区块链的协议，让交易双方可以直接进行点对点的兑换。由于无需交易平台方参与，交易成本较低，而且可以实时完成，也不用担心安全风险。目前，去中心化交易所是去中心化金融领域最热门的课题之一。

要实现去中心化交易所，需要解决一些基本问题：

- 交易能自动完成，无需人工参与；
- 交易过程中无人能造假或欺骗对方；
- 自动计算汇率，并根据汇率来完成交易；
- 避免市场发生过大波动，带来损失。

目前，去中心化交易所根据其订单位置，主要包括三种模式：链上记账、链下记账和自动做市商（Automated Market Makers，AMM）。

### 链上记账

链上记账的思路十分简单，将兑换交易直接存储在区块链上。

该模式实现简单，但是存在较大缺陷。

- 每笔交易都需要上链，会产生记账费用。当交易频繁时，记账成本过高；
- 需要将所有信息记录在链上，可能会产生有人提前知晓交易信息而获益；
- 交易较多时，对区块链的性能要求很高，大部分公有链都无法支持。

采用该方案的平台包括 Stellar 等。

### 链下记账

与链上记账相反，链下记账将交易存放在第三方平台上。第三方平台仅当需要时候才将交易写入区块链。

这种方式可以避免写入大量交易到区块链，但是需要依赖第三方平台，存在较高的安全风险。

采用该方案的平台包括 Binance 等。

### 自动做市商 AMM

类似证券市场中的做市商，可以使用智能合约来实现自动化的做市商机制。

用户需要兑换货币时，不跟其他用户直接进行交易，而是和区块链智能合约进行兑换。

智能合约背后根据其流动资金池和定价算法（如倒数曲线、直线等）实时算出汇率。每笔交易会收取少量的手续费（如 Uniswap 收取 0.3%）。

该机制无需依赖交易记账，交易成本通常较低，且风险小。

用户也可以将持有的货币按照协议投入流动资金池中，成为流动性提供者（Liquidity Provider，LP）。流动性提供者可以获得交易手续费带来的收益。

该模式主要的问题是市场深度依赖流动资金池，要平衡好 LP 收益和交易成本之间的矛盾。同时，当货币价格波动较大时，LP 可能产生暂时性损失（Impermanent Loss）。

典型的实现协议包括 Uniswap、Bancor 等，平台包括 Kyber 等。



**流动性挖矿与 AMM 的关系**
 流动性挖矿（Yield Farming）是指用户将加密货币存入 DeFi 协议的资金池中，从而赚取手续费和额外的代币奖励。自动化做市商（AMM）则是这类资金池的核心机制，它通过公式（如 *x·y=k*）来实现代币的定价与交换。

AMM 为流动性挖矿提供了基础设施，用户将资金注入 AMM 池子，既能获得交易手续费，又可能通过协议激励获得治理代币。可以理解为：**AMM 是土壤，流动性挖矿是耕作，用户则是把资金“种”进去收获回报。**

  

## Hyperledger（超级账本）

Hyperledger（超级账本）是一个由 **Linux 基金会主导的开源协作项目**，目标是为企业打造 **分布式账本技术（DLT, Distributed Ledger Technology）和区块链解决方案** 的基础平台与生态。

- 不同于比特币、以太坊这类面向公众的公有链，Hyperledger 更偏向 **联盟链 / 私有链**。

- 强调 **高性能、可控权限、隐私保护**，满足银行、供应链、医疗等行业的需求。

- Hyperledger 不是单一平台，而是多个子项目的集合（类似一个“开源大伞”）。

- 这些子项目覆盖 **区块链底层框架、工具、库**，方便企业选择和定制。

## 合约

## 🔑 1. 普通转账 vs 合约交易

- **ETH 转账**：

  - 直接链上余额变动，不需要合约。

  - `to` 就是收款人的钱包地址。

- **代币转账（ERC-20/721/1155 等）**：

  - 本质是调用合约的函数（如 `transfer` / `transferFrom`）。

  - `to` 指向代币合约地址，收款人地址要在交易 data 或日志里找。

- **合约部署**：

  - `to=null`，执行成功后生成一个新合约地址。

---

## 🔑 2. transfer 函数

- **标准由谁定义**：以太坊社区通过 ERC 提案流程规定接口（如 `transfer`、`balanceOf`）。

- **具体谁写的**：各代币项目方自己实现（比如 USDT 的 Tether 团队）。

- **作用**：修改合约内部的 `balances` 映射，并触发 `Transfer` 事件。

---

## 🔑 3. transfer 会变吗？

- **不可升级合约**：一旦部署，代码永久写死，`transfer` 不会变。

- **可升级合约（Proxy 模式）**：接口不变，但项目方可升级逻辑。比如 Tether 正在迁移到 USDT0，用了 proxy 机制。

---

## 🔑 4. 合约地址会变吗？

- **不会变**：由 `部署者地址 + nonce` 算出，一旦部署就永久固定。

- **新版本合约**：如果项目迁移（比如旧 USDT → 新 USDT0），那是**新合约新地址**，旧地址依然存在，不会“变掉”。

---

### ✅ 总结一句话

- ETH 转账不需要合约；代币转账都要通过合约的 `transfer` 或类似函数。

- `transfer` 是代币开发团队按 ERC 标准写的，通常不会变，除非用了可升级合约。

- 合约地址一旦生成就固定不变，迁移只会出现新的合约地址。

---

## ICO

ICO = **Initial Coin Offering（首次代币发行）**。

可以理解为区块链世界里的 **“代币版众筹”**：

- 项目方发行一种新的加密代币（Token）；

- 投资者用比特币、以太坊等已有的主流加密货币来购买这些代币；

- 项目方通过出售代币获得资金，用于开发和运营项目；

- 投资者则期望这些代币未来升值，或者能在项目生态中使用。

---

## 区块链账本模型对比

| 模型         | 代表链                      | 优点                         | 缺点                     |
| ------------ | --------------------------- | ---------------------------- | ------------------------ |
| **UTXO**     | Bitcoin、Litecoin           | 去中心化、并行度高、隐私好   | 编程复杂，不适合复杂合约 |
| **账户模型** | Ethereum、TRON、BNB、Solana | 直观，支持智能合约，开发友好 | 隐私差，容易被追踪       |

✅ 一句话总结：  

- **UTXO 模型**：像现金，交易是“零钱的输入输出”。  
- **账户模型**：像银行卡，账本直接记录“谁有多少钱”。  

---

## 常见区块链架构

### 1. 比特币（Bitcoin, BTC）

- 类型：公有链  
- 共识机制：PoW（工作量证明）  
- 账本结构：UTXO 模型  
- 架构特点：极简，只有转账功能；无智能合约，主要用于点对点支付  
- 适用场景：数字货币、价值存储  

### 2. 以太坊（Ethereum, ETH）

- 类型：公有链  
- 共识机制：PoS（权益证明，2022年合并后）  
- 账本结构：账户模型  
- 架构特点：支持智能合约（Solidity/EVM）；执行环境是 EVM；去中心化开放性强，但性能有限（10-20 TPS）  
- 适用场景：DeFi、NFT、DAO、GameFi  

### 3. TRON（波场, TRX）

- 类型：公有链  
- 共识机制：DPoS（委托权益证明，27个超级代表出块）  
- 账本结构：账户模型  
- 架构特点：高性能（号称 2000+ TPS）；低手续费；EVM 兼容  
- 适用场景：支付、跨境转账（尤其是 USDT 流通链）  

### 4. BNB Chain（Binance Smart Chain, BSC）

- 类型：公有链  
- 共识机制：PoSA（Proof of Staked Authority，权益质押 + 权威证明）  
- 账本结构：账户模型  
- 架构特点：高吞吐量（几千 TPS）；与以太坊完全兼容（EVM）；Binance 生态支持，中心化程度较高  
- 适用场景：DeFi、GameFi、CEX 对接  

### 5. Solana（SOL）

- 类型：公有链  
- 共识机制：PoH（历史证明）+ PoS  
- 账本结构：账户模型  
- 架构特点：高性能（理论上 5万+ TPS）；“历史证明”减少延迟；开发语言 Rust/C++  
- 适用场景：高频交易、DeFi、GameFi  

### 6. Avalanche（AVAX）

- 类型：公有链  
- 共识机制：Avalanche 共识 + PoS  
- 账本结构：账户模型  
- 架构特点：主网由多个子链（X-Chain、P-Chain、C-Chain）组成；支持定制子网（Subnet）；EVM 兼容（C-Chain）  
- 适用场景：DeFi、定制区块链网络  

### 7. Polkadot（DOT）

- 类型：公有链（多链架构）  
- 共识机制：NPoS（提名权益证明）  
- 账本结构：账户模型  
- 架构特点：中继链（Relay Chain）+ 平行链（Parachains）；共享安全性；跨链通信（XCMP）  
- 适用场景：多链互操作、跨链应用  

### 8. Cosmos（ATOM）

- 类型：公有链（多链互操作）  
- 共识机制：Tendermint BFT + PoS  
- 账本结构：账户模型  
- 架构特点：Hub-and-Zone 模式；IBC 跨链通信协议；模块化链设计  
- 适用场景：跨链生态、模块化应用链  

### 9. Base（Coinbase 出品）

- 类型：以太坊二层（Layer 2）  
- 共识机制：继承以太坊安全性（Optimistic Rollup）  
- 账本结构：账户模型  
- 架构特点：基于 Optimism 的 OP Stack；低手续费、EVM 兼容；Coinbase 背书，合规化程度高  
- 适用场景：Web2 用户进入 Web3 的入口，DeFi、社交应用  

---

### 总结对比表

| Chain     | 类型   | 共识机制       | 架构/特点                 | 主要应用         |
| --------- | ------ | -------------- | ------------------------- | ---------------- |
| Bitcoin   | 公有链 | PoW            | UTXO 模型，简单安全       | 价值存储、支付   |
| Ethereum  | 公有链 | PoS            | EVM，智能合约，去中心化   | DeFi、NFT        |
| TRON      | 公有链 | DPoS           | EVM 兼容，高性能          | 支付、USDT       |
| BNB Chain | 公有链 | PoSA           | 高吞吐量，EVM 兼容        | DeFi、GameFi     |
| Solana    | 公有链 | PoH+PoS        | 高性能，Rust 开发         | 高频交易、GameFi |
| Avalanche | 公有链 | Avalanche+PoS  | 子网架构，EVM 兼容        | DeFi、应用链     |
| Polkadot  | 公有链 | NPoS           | 中继链+平行链，多链互操作 | 跨链生态         |
| Cosmos    | 公有链 | Tendermint+PoS | Hub-Zone，IBC 跨链通信    | 模块化链、跨链   |
| Base      | L2     | Rollup (OP)    | 以太坊 L2，Coinbase 背书  | DeFi、Web3入口   |

---

## 数字货币 vs Token

- **数字货币**：一个大类，既包括官方的数字人民币，也包括去中心化的比特币。  
- **Token**：狭义上的代币，通常指基于某条链发行的资产，比如 USDT、NFT。  

| 分类 | 数字货币                                             | Token                                      |
| ---- | ---------------------------------------------------- | ------------------------------------------ |
| 定义 | 以数字形式存在的货币总称，包括央行数字货币和加密货币 | 基于已有区块链发行的数字资产               |
| 代表 | 数字人民币、比特币、以太坊                           | USDT、UNI、NFT、GameFi 道具                |
| 依赖 | 可以独立存在（比如比特币有自己区块链）               | 必须依附在主链上（比如 ETH 链上的 ERC-20） |

---

## PBFT 总结

### 📌 核心思想

- 在 **3f + 1** 个节点中，最多允许 **f 个拜占庭节点**（作恶/故障）。  
- 通过 **多阶段消息交互**，保证所有诚实节点最终达成一致。  

**目标**：在存在拜占庭节点时，仍能保证 **一致性**（所有诚实节点对交易顺序达成一致）。

---

### ⚙️ 工作流程（四步）

1. **Request**：客户端请求发给主节点（Leader）。  
2. **Pre-prepare**：主节点分配序号并广播。  
3. **Prepare**：所有副本节点验证并互相广播。  
   - 收到 ≥2f+1 一致消息 → 进入提交阶段。  
4. **Commit**：节点广播提交消息，收集到 ≥2f+1 → 执行并回复客户端。  

---

## Nakamoto 共识

- PoW / PoS / PoX。  
- 特点：引入经济学手段，牺牲确定性，换来大规模可扩展性。  



------

## 共识机制对比

- **Nakamoto 共识（PoW/PoS/PoX）**：经济学手段，牺牲确定性，换取可扩展性。
- **PBFT**：小规模、高确定性，适合联盟链。

---

## 多签

1. TON 链，用户被骗，被多签了。  
2. 设备迁移过，发送交易的地址和签名地址不一样。  





# Web3 签名转账 & Gas 机制笔记

## 1. 签名转账上链流程

1. **准备交易参数**（nonce, to, value, data, gasLimit, fee 设置, chainId）。
2. **本地序列化并签名**（私钥签名 → ECDSA → rawTx）。
3. **广播交易到网络**（进入节点的 mempool）。
4. **区块提议者/验证者打包并共识**。
5. **状态更新**：ETH 余额变动 / ERC20 合约执行日志。

## 2. 交易参数详解（ETH / ERC20）

- **nonce**：交易序号，保证顺序和防重放。
- **to**：
  - ETH 转账：收款人地址。
  - ERC20 转账：代币合约地址。
- **value**：
  - ETH 转账：金额（wei）。
  - ERC20 转账：=0。
- **data**：
  - ETH 转账：空。
  - ERC20 转账：`transfer(to, amount)` 的 ABI 编码。
- **gasLimit**：最大 Gas 消耗（ETH 转账约 21,000，ERC20 转账约 50,000–80,000）。
- **maxPriorityFeePerGas**：小费，激励打包者优先选择你的交易。
- **maxFeePerGas**：最高 Gas 单价上限，防止被宰。
- **chainId**：链的 ID，防止跨链重放。



笔记：

- **Gas = 运算量**，**Fee = 运算量 × 单价**。
- **BaseFee** 销毁，**PriorityFee** 给打包者，**MaxFee** 保护用户。
- ETH 在高使用期可能通缩，冷清期可能轻微通胀。

------

## 3. BaseFee / PriorityFee / MaxFee

- **BaseFee**
  - 每个区块自动调整的最低费率。
  - 所有交易必须至少支付。
  - 直接销毁（burn），不会给打包者。
- **PriorityFee（tip）**
  - 用户额外支付的小费。
  - 直接归打包者。
  - 设置越高，打包越快。
- **MaxFee**
  - 用户愿意支付的最高 Gas 单价。
  - 实际支付不会超过这个值。

公式：

```
实际单价 = min(MaxFee , BaseFee + PriorityFee)
手续费 = gasUsed × 实际单价
```

------

## 4. 手续费计算示例

条件：

- `gasUsed = 21,000`
- `BaseFee = 20 gwei`
- `MaxFee = 40 gwei`
- `PriorityFee = 2 gwei`

计算：

- 实际单价 = min(40, 20+2) = 22 gwei
- 手续费 = 21,000 × 22 gwei ≈ 0.000462 ETH

分配：

- 21,000 × 20 gwei = 0.00042 ETH → **销毁**
- 21,000 × 2 gwei = 0.000042 ETH → **打包者收入**

------

## 5. Gas 单位与 Fee 单位

- **Gas**：EVM 运算步骤数，虚拟单位，不是货币。
- **Gas Price / Fee Per Gas**：每单位 Gas 的价格，单位 wei/gas（常用 gwei）。
- **Fee**：最终手续费，= gasUsed × 实际单价，结果单位 ETH。



------

## 6. ETH 销毁机制

- **BaseFee 部分被销毁**，使 ETH 带有通缩属性。
- 链上活动高峰期：销毁量 > 增发量 → **ETH 净通缩**。
- 活动低迷期：销毁量 < 增发量 → **ETH 轻微通胀**。
- ETH 总量 = 增发（质押奖励） - 销毁（BaseFee）。

# Web3 账户与标准笔记

## 1. EOA（Externally Owned Account, 外部账户）
- **定义**：由私钥控制的账户，没有代码逻辑。
- **特点**：
  - 可以主动发起交易（通过签名）。
  - 有余额（ETH、代币）。
  - 没有合约逻辑，不能自己执行函数。
- **应用场景**：用户钱包地址（MetaMask、硬件钱包等）。
- **安全风险**：私钥泄露 = 资金完全丢失。

---

## 2. 合约账户（Contract Account, CA）
- **定义**：由合约代码控制的账户，没有私钥。
- **特点**：
  - 不能主动发起交易，只能被调用。
  - 有合约逻辑，能执行复杂功能。
  - 创建时需要部署合约，支付 gas。
- **应用场景**：
  - ERC-20 / ERC-721 / ERC-1155 代币合约。
  - DEX（如 Uniswap）、借贷协议（如 Aave）。
  - 多签钱包、DAO 金库。
- **安全风险**：合约漏洞可能导致资金被盗。

---

## 3. EOA 与 合约账户对比

| 特性         | EOA (外部账户) | 合约账户 (CA)             |
| ------------ | -------------- | ------------------------- |
| 控制方式     | 私钥           | 合约代码                  |
| 是否能发交易 | ✅ 主动         | ❌ 只能被动响应            |
| 是否有代码   | ❌ 无           | ✅ 有逻辑                  |
| 创建方式     | 生成公私钥即可 | 部署合约时自动生成        |
| 应用场景     | 用户钱包       | 代币、DEX、借贷、NFT、DAO |

合约账户是每次部署合约生成的。



## 4. EIP-7702

- **背景**：
  - 传统 EOA 功能有限（只能签名/发交易）。
  - 合约账户功能强大，但迁移成本高。
- **定义**：
  - 让 EOA 在一笔交易中，临时「挂接合约逻辑」。
  - 表现得像一个合约账户，交易执行后恢复 EOA。
- **作用**：
  - 一次签名即可执行多步操作（如 approve → swap → stake）。
  - 批量交易、自动支付、社交恢复、多签。
  - 支持代付 gas，不一定要用 ETH。
- **关系**：
  - 7702 不是新建合约账户，而是给 EOA 临时附加“合约能力”。

---

## 5. 为什么需要 7702？
1. **扩展 EOA 功能**：支持批量操作、代付 gas。
2. **兼容性好**：不必换钱包地址，旧的 EOA 也能获得新功能。
3. **安全**：可以在交易中添加风控逻辑（多签、限制转账等）。
4. **Account Abstraction**：迈向账户抽象的关键一步。

---

## 6. 7702 与 GetGas 的关系
- **问题**：传统 EOA 只能用 ETH 支付 gas，不能指定其他代币。
- **解决**：
  - 通过 7702，让 EOA 在该交易中变身为“合约账户”。
  - 合约账户逻辑可以：
    - 指定由第三方 Paymaster 代付 gas。
    - 使用 USDT/DAI 等代币抵扣 gas。
    - 让 DApp 赞助 gas 费用。
- **结论**：GetGas 等代付机制需要依赖 7702 的“合约逻辑”，否则普通 EOA 无法实现。

---

## 7. 一次签名，多步操作
- **传统方式**：每步操作（approve、swap、stake）都要单独签名、支付 gas。
- **7702/AA 方式**：
  - 把多个操作打包成一次交易。
  - 用户一次签名，合约账户在链上依次执行。
- **好处**：
  - 提升用户体验（少签名）。
  - 节省 gas（共享部分开销）。
  - 原子性：要么全部成功，要么全部失败。

---

## 总结
- **EOA**：由私钥控制的钱包，简单但功能有限。
- **合约账户**：由代码控制，功能强大但不能主动发交易。
- **EIP-7702**：让 EOA 临时获得合约账户能力，实现批量交易、代付 gas、账户抽象。
- **GetGas**：依赖 7702 才能实现灵活的 Gas 支付（代币代付、第三方代付）。
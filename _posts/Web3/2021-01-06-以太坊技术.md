---
layout: post
category: Web3
title: ä»¥å¤ªåŠæŠ€æœ¯
tags: Web3
---

# ä»¥å¤ªåŠæŠ€æœ¯

[å»–é›ªå³°ç¬”è®°å‚è€ƒ](https://liaoxuefeng.com/books/blockchain/ethereum/index.html)

## ä»¥å¤ªåŠ

ä»¥å¤ªåŠï¼ˆEthereumï¼‰æ˜¯ä¸€ä¸ªæ”¯æŒæ™ºèƒ½åˆçº¦çš„åŒºå—é“¾å¹³å°ï¼Œå®ƒä¸æ¯”ç‰¹å¸æœ€å¤§çš„ä¸åŒæ˜¯ï¼Œä»¥å¤ªåŠé€šè¿‡ä¸€ä¸ªè™šæ‹Ÿæœºï¼ˆEVMï¼‰å¯ä»¥è¿è¡Œæ™ºèƒ½åˆçº¦ã€‚

ä»¥å¤ªåŠæ˜¯[Vitalik Buterin](https://vitalik.ca/)ï¼ˆç»´å¡”åˆ©å…‹Â·å¸ƒç‰¹æ—ï¼Œäººç§°Vç¥ï¼‰åœ¨2013å¹´æå‡ºçš„æ¦‚å¿µï¼ŒVitalikæœ€æ—©å‚ä¸äº†æ¯”ç‰¹å¸ç¤¾åŒºçš„å¼€å‘ï¼Œå¹¶å¸Œæœ›æ¯”ç‰¹å¸æŠŠåŠŸèƒ½å—é™çš„è„šæœ¬æ‰©å±•æˆå›¾çµå®Œå…¨çš„ç¼–ç¨‹ç¯å¢ƒï¼Œä½†æ²¡æœ‰å¾—åˆ°æ¯”ç‰¹å¸å¼€å‘ç¤¾åŒºçš„è®¤åŒï¼Œäºæ˜¯ä»–å†³å®šå¦èµ·ç‚‰ç¶ï¼Œæ‰“é€ ä¸€ä¸ªæ–°çš„åŒºå—é“¾å¹³å°ï¼Œç›®æ ‡æ˜¯è¿è¡Œå»ä¸­å¿ƒåŒ–çš„ç¨‹åºã€‚

ä»¥å¤ªåŠä»2015å¹´æ­£å¼å¯åŠ¨å¹¶è¿è¡Œï¼ŒæœŸé—´ç»å†è¿‡DAOæ”»å‡»é€ æˆçš„ç¡¬åˆ†å‰ã€‚å’Œæ¯”ç‰¹å¸ç±»ä¼¼ï¼Œä»¥å¤ªåŠä¹Ÿé€šè¿‡PoWè¿›è¡ŒæŒ–çŸ¿ï¼Œåæ”¹ä¸ºPoSæŒ–çŸ¿ï¼Œå…¶æŒ–å‡ºçš„å¹³å°å¸å«ä»¥å¤ªå¸ï¼ˆEtherï¼‰ï¼Œç›®å‰æ¯ä¸ªåŒºå—å¥–åŠ±æ˜¯2 Etherï¼Œçº¦13~15ç§’å·¦å³å‡ºä¸€ä¸ªå—ã€‚

å’Œæ¯”ç‰¹å¸ç›¸æ¯”ï¼Œä»¥å¤ªåŠåœ¨ä»¥ä¸‹å‡ ç‚¹ä¸Šæœ‰æ‰€ä¸åŒï¼š



**è´¦æˆ·æ¨¡å‹**

æ¯”ç‰¹å¸ä½¿ç”¨çš„[UTXOæ¨¡å‹](https://liaoxuefeng.com/books/blockchain/bitcoin/utxo/index.html)æ˜¯ä¸€ç§å¯¹å¼€å‘å‹å¥½ã€æ˜“äºå®ç°æ¸…ç»“ç®—çš„æ¨¡å‹ï¼Œä½†å¯¹ç”¨æˆ·ä¸å‹å¥½ï¼Œå› ä¸ºæ™®é€šç”¨æˆ·æ‰€è®¤çŸ¥çš„è´¦æˆ·æ˜¯ä¸€ä¸ªè´¦å·ã€å¯¹åº”ä½™é¢å˜åŠ¨çš„æ¨¡å‹ã€‚ä»¥å¤ªåŠçš„è´¦æˆ·æ¨¡å‹å’Œæ¯”ç‰¹å¸ä¸åŒï¼Œå®ƒå°±æ˜¯ä½™é¢æ¨¡å‹ï¼Œå³äº¤æ˜“å¼•å‘è´¦æˆ·ä½™é¢çš„å˜åŠ¨ï¼Œè¿™ä¸ä¼ ç»Ÿé‡‘èè´¦æˆ·ä¸€è‡´ã€‚

**æ™ºèƒ½åˆçº¦**

ä»æ¯”ç‰¹å¸çš„[å¯ç¼–ç¨‹æ”¯ä»˜åŸç†](https://liaoxuefeng.com/books/blockchain/bitcoin/pay/index.html)å¯çŸ¥ï¼Œä»»ä½•æ”¯ä»˜å®é™…ä¸Šéƒ½æ˜¯åœ¨æ‰§è¡Œæ¯”ç‰¹å¸è„šæœ¬ï¼Œåªæœ‰è„šæœ¬æˆåŠŸæ‰§è¡Œï¼Œæ”¯ä»˜æ‰èƒ½æˆåŠŸã€‚

ä»¥å¤ªåŠçš„äº¤æ˜“ä¸ä¹‹ç±»ä¼¼ï¼Œå¹¶ä¸”æ›´è¿›ä¸€æ­¥ï¼Œå®ƒå®ç°äº†ä¸€ä¸ªå›¾çµå®Œå¤‡çš„è„šæœ¬è¯­è¨€ï¼Œè¿è¡Œåœ¨EVMï¼ˆEthereum Virtual Machineï¼Œä»¥å¤ªåŠè™šæ‹Ÿæœºï¼‰ä¸­ï¼Œä»»ä½•äººéƒ½å¯ä»¥ç¼–å†™åˆæ³•çš„è„šæœ¬æ¥æ‰§è¡Œä»»æ„é€»è¾‘ï¼ˆæœ‰å¾ˆå¤šé™åˆ¶ï¼‰ï¼Œä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ç§æ–°çš„ä»£å¸ï¼ŒæŠµæŠ¼è´·æ¬¾ç­‰ã€‚

------

## è´¦æˆ·

ä»¥å¤ªåŠè´¦æˆ·è´Ÿè´£å­˜å‚¨ç”¨æˆ·çš„ä»¥å¤ªåŠä½™é¢ã€‚å¯¹å¤§å¤šæ•°æ™®é€šç”¨æˆ·æ¥è¯´ï¼Œä»¥å¤ªåŠè´¦æˆ·å’Œé“¶è¡Œè´¦æˆ·éå¸¸ç±»ä¼¼ï¼Œé€šå¸¸åªéœ€è¦ä¸€ä¸ªè´¦æˆ·å³å¯ã€‚

ç¡®åˆ‡åœ°è¯´ï¼Œä»¥å¤ªåŠè´¦æˆ·åˆ†ä¸ºå¤–éƒ¨è´¦æˆ·å’Œåˆçº¦è´¦æˆ·ä¸¤ç±»ï¼š

- å¤–éƒ¨è´¦æˆ·ï¼šå³æ™®é€šç”¨æˆ·ç”¨ç§é’¥æ§åˆ¶çš„è´¦æˆ·ï¼›
- åˆçº¦è´¦æˆ·ï¼šä¸€ç§æ‹¥æœ‰åˆçº¦ä»£ç çš„è´¦æˆ·ï¼Œå®ƒä¸å±äºä»»ä½•äººï¼Œä¹Ÿæ²¡æœ‰ç§é’¥ä¸ä¹‹å¯¹åº”ã€‚

æœ¬èŠ‚æˆ‘ä»¬ä»…è®¨è®ºæ™®é€šç”¨æˆ·ä½¿ç”¨çš„å¤–éƒ¨è´¦æˆ·ã€‚



å’Œæ¯”ç‰¹å¸ç±»ä¼¼ï¼Œä¸€ä¸ªä»¥å¤ªåŠè´¦æˆ·å°±æ˜¯ä¸€ä¸ªå…¬é’¥å“ˆå¸Œåå¾—åˆ°çš„åœ°å€ï¼Œå®ƒæ˜¯ç”±ä¸€ä¸ªç§é’¥æ¨å¯¼å‡ºå¯¹åº”çš„å…¬é’¥ï¼Œç„¶åå†è®¡ç®—å‡ºåœ°å€ã€‚å…¶ä¸­ï¼Œç§é’¥ä¸å…¬é’¥ç®—æ³•ä¸æ¯”ç‰¹å¸å®Œå…¨ç›¸åŒï¼Œå‡ä¸ºsecp256k1æ¤­åœ†æ›²çº¿ï¼Œä½†å’Œæ¯”ç‰¹å¸ä¸åŒçš„æ˜¯ï¼Œä»¥å¤ªåŠé‡‡ç”¨éå‹ç¼©å…¬é’¥ï¼Œç„¶åç›´æ¥å¯¹å…¬é’¥åškeccak256å“ˆå¸Œï¼Œå¾—åˆ°32å­—èŠ‚çš„å“ˆå¸Œå€¼ï¼Œå–å20å­—èŠ‚åŠ ä¸Š`0x`å‰ç¼€å³ä¸ºåœ°å€



å› ä¸ºä»¥å¤ªåŠå’Œæ¯”ç‰¹å¸çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œä¸åŒçš„ä»…ä»…æ˜¯å…¬é’¥å’Œåœ°å€çš„è¡¨ç¤ºæ ¼å¼ï¼Œå› æ­¤ï¼Œæ¯”ç‰¹å¸çš„HDé’±åŒ…ä½“ç³»ä¹Ÿå®Œå…¨é€‚ç”¨äºä»¥å¤ªåŠã€‚ç”¨æˆ·é€šè¿‡ä¸€å¥—åŠ©è®°è¯ï¼Œæ—¢å¯ä»¥ç®¡ç†æ¯”ç‰¹å¸é’±åŒ…ï¼Œä¹Ÿå¯ä»¥ç®¡ç†ä»¥å¤ªåŠé’±åŒ…ã€‚

ä»¥å¤ªåŠé’±åŒ…çš„æ´¾ç”Ÿè·¯å¾„æ˜¯`m/44'/60'/0'/0/0`

å› ä¸ºä»¥å¤ªåŠé‡‡ç”¨è´¦æˆ·ä½™é¢æ¨¡å‹ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸€ä¸ªä»¥å¤ªåŠåœ°å€å·²å¤Ÿç”¨ã€‚å¦‚æœè¦ç”Ÿæˆå¤šä¸ªåœ°å€ï¼Œå¯ç»§ç»­æ´¾ç”Ÿ`m/44'/60'/0'/0/1`ã€`m/44'/60'/0'/0/2`ç­‰ã€‚

## åŒºå—ç»“æ„





æ¯”ç‰¹å¸çš„åŒºå—é“¾æ˜¯ç”±PoWä¿è¯æ¯ä¸ªåŒºå—éƒ½æŒ‡å‘å‰ä¸€ä¸ªåŒºå—ï¼Œè€Œåœ¨æ¯ä¸€ä¸ªåŒºå—å†…éƒ¨ï¼Œç”±ä¸€ä¸ªç‹¬ç«‹çš„Merkle Treeæ¥ä¿è¯æ‰€æœ‰äº¤æ˜“çš„ä¸å¯ç¯¡æ”¹ã€‚ç”¨æˆ·çš„æ¯”ç‰¹å¸æ˜¯ä»¥UTXOçš„æ–¹å¼å­˜å‚¨çš„ï¼Œå› æ­¤ï¼Œæ¯”ç‰¹å¸çš„äº¤æ˜“å°±æ˜¯ä¸æ–­åœ°æ¶ˆè€—ç°æœ‰çš„UTXOï¼Œå¹¶äº§ç”Ÿæ–°çš„UTXOã€‚

è€Œä»¥å¤ªåŠé‡‡ç”¨çš„æ˜¯è´¦æˆ·æ¨¡å‹ï¼Œå¦‚æœå°æ˜çš„è´¦æˆ·åœ¨æŸä¸ªåŒºå—çš„èµ„äº§æ˜¯1 ETHï¼Œå½“å°æ˜ç»™å°çº¢è½¬è´¦0.2 ETHåï¼Œåˆ¨é™¤æ‰‹ç»­è´¹ï¼Œä»–çš„è´¦æˆ·è¿˜å‰©ä¸‹çº¦0.8 ETHã€‚ç”±äºå°æ˜çš„è´¦æˆ·åœ°å€ä¸å˜ï¼Œæ‰€ä»¥ï¼Œä»¥å¤ªåŠçš„åŒºå—ç»“æ„å¿…é¡»èƒ½åœ¨æ¯ä¸ªåŒºå—æŒç»­åœ°è·Ÿè¸ªå¹¶è®°å½•å°æ˜çš„è´¦æˆ·ä½™é¢å˜åŠ¨ã€‚å› æ­¤ï¼Œå’Œæ¯”ç‰¹å¸ç›¸æ¯”ï¼Œä»¥å¤ªåŠçš„åŒºå—æ•°æ®ç»“æ„æ›´åŠ å¤æ‚ã€‚



**ä»¥å¤ªåŠçš„æ ¸å¿ƒæ•°æ®ç»“æ„æ˜¯ä»¥Merkle Patricia Treeè®°å½•çš„ä¸–ç•ŒçŠ¶æ€ï¼Œæ¯ä¸ªåŒºå—é€šè¿‡æ‰“åŒ…æ–°çš„äº¤æ˜“ï¼Œä»è€Œå¯¼è‡´ä¸–ç•ŒçŠ¶æ€çš„å˜åŒ–ã€‚**

### Merkle Patricia Tree

ä»¥å¤ªåŠå­˜å‚¨è´¦æˆ·æ•°æ®çš„æ•°æ®ç»“æ„æ˜¯MPTï¼šMerkle Patricia Treeï¼Œå®ƒæ˜¯ä¸€ç§æ”¹è¿›çš„Merkle Treeã€‚å½“MPTçš„æ¯ä¸ªå¶å­ç»“ç‚¹çš„å€¼ç¡®å®šåï¼Œè®¡ç®—å‡ºçš„Root Hashå°±æ˜¯å®Œå…¨ç¡®å®šçš„ã€‚ä¾‹å¦‚ï¼Œåœ¨ç¬¬ä¸€ä¸ªåŒºå—ä¸­ï¼Œ4ä¸ªè´¦æˆ·çš„ä½™é¢ç¡®å®šåï¼Œå³å¯ç¡®å®š`Root1`ï¼š

```
â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”
           Root1
â”‚          â”Œâ”€â”€â”€â”          â”‚
           â”‚   â”‚
â”‚          â””â”€â”€â”€â”˜          â”‚
             â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”      â”‚
       â”‚           â”‚
â”‚    â”Œâ”€â”€â”€â”       â”Œâ”€â”€â”€â”    â”‚
     â”‚   â”‚       â”‚   â”‚
â”‚    â””â”€â”€â”€â”˜       â””â”€â”€â”€â”˜    â”‚
       â”‚           â”‚
â”‚   â”Œâ”€â”€â”´â”€â”€â”     â”Œâ”€â”€â”´â”€â”€â”   â”‚
    â”‚     â”‚     â”‚     â”‚
â”‚ â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”‚
  â”‚5.5â”‚ â”‚0.2â”‚ â”‚1.7â”‚ â”‚9.0â”‚
â”‚ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â”‚
 â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€
```

åœ¨ç¬¬äºŒä¸ªåŒºå—ä¸­ï¼Œå¦‚æœå‘ç”Ÿäº†è½¬è´¦ï¼Œå°†è®¡ç®—å‡ºä¸€ä¸ªæ–°çš„`Root2`

æ¯ä¸€ä¸ªåŒºå—é€šè¿‡Root Hashå°†å®Œå…¨ç¡®å®šæ‰€æœ‰è´¦æˆ·çš„çŠ¶æ€ï¼Œæ‰€ä»¥ï¼Œä»å…¨å±€çœ‹ï¼Œä»¥å¤ªåŠå°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œæ¯ä¸ªåŒºå—é€šè¿‡è®°å½•ä¸€ä¸ª`stateRoot`æ¥è¡¨ç¤ºä¸€ä¸ªæ–°çŠ¶æ€ã€‚å¦‚æœç»™å®šæŸä¸ªåŒºå—çš„`stateRoot`ï¼Œæˆ‘ä»¬è‚¯å®šèƒ½å®Œå…¨ç¡®å®šæ‰€æœ‰è´¦æˆ·çš„æ‰€æœ‰ä½™é¢ç­‰ä¿¡æ¯ã€‚å› æ­¤ï¼Œ`stateRoot`å°±è¢«ç§°ä¸ºå½“å‰çš„ä¸–ç•ŒçŠ¶æ€ã€‚

æœ‰çš„åŒå­¦å¯èƒ½ä¼šæ€è€ƒï¼Œå¦‚æœç¬¬ä¸€ä¸ªåŒºå—åªæœ‰å‡ ä¸ªè´¦æˆ·ï¼Œéšç€è´¦æˆ·çš„å¢åŠ ï¼Œå¦‚æœæœ‰æ•°ç™¾ä¸‡ä¸ªè´¦æˆ·ï¼Œåˆ°åé¢å²‚ä¸æ˜¯åŒºå—å­˜å‚¨çš„æ•°æ®é‡ä¼šè¶Šæ¥è¶Šå¤§ï¼Ÿ

**å®é™…ä¸Šï¼Œæ¯ä¸ªåŒºå—çš„`stateRoot`è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå®Œå…¨çŠ¶æ€çš„é€»è¾‘æ ‘ï¼Œä½†æ¯ä¸ªåŒºå—è®°å½•çš„æ•°æ®åªåŒ…æ‹¬ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œå¦‚æœæˆ‘ä»¬è§‚å¯Ÿç¬¬äºŒä¸ªåŒºå—çš„æ ‘ï¼Œå®ƒå®é™…ä¸Šåªè®°å½•ä¿®æ”¹çš„ä¸¤ä¸ªè´¦æˆ·ï¼Œä»¥åŠä¸¤ä¸ªè´¦æˆ·å› ä¿®æ”¹åå¯¼è‡´çš„ä¸Šå±‚è·¯å¾„çš„Hashå‘ç”Ÿçš„å˜åŒ–**

### è´¦æˆ·æ•°æ®

ä¸€ä¸ªä»¥å¤ªåŠè´¦æˆ·ç”±4éƒ¨åˆ†æ•°æ®æ„æˆï¼š

- nonce
- balance
- storageRoot
- codeHash

å…¶ä¸­ï¼Œ`nonce`æ˜¯ä¸€ä¸ªé€’å¢çš„æ•´æ•°ï¼Œæ¯å‘é€ä¸€æ¬¡äº¤æ˜“ï¼Œ`nonce`é€’å¢`1`ï¼Œå› æ­¤ï¼Œ`nonce`è®°å½•çš„å°±æ˜¯äº¤æ˜“æ¬¡æ•°ã€‚

`balance`è®°å½•çš„å°±æ˜¯è´¦æˆ·ä½™é¢ï¼Œä»¥`wei`ä¸ºå•ä½ï¼Œ1 Etherç­‰äº1018weiã€‚

å¦‚æœä¸€ä¸ªè´¦æˆ·æ˜¯åˆçº¦è´¦æˆ·ï¼Œåˆ™`storageRoot`å­˜å‚¨åˆçº¦ç›¸å…³çš„çŠ¶æ€æ•°æ®ï¼Œ`codeHash`å­˜å‚¨åˆçº¦ä»£ç çš„Hashã€‚å¯¹äºå¤–éƒ¨è´¦æˆ·ï¼Œè¿™ä¸¤éƒ¨åˆ†æ•°æ®éƒ½æ˜¯ç©ºã€‚

### äº¤æ˜“

ä»¥å¤ªåŠçš„äº¤æ˜“éœ€è¦æ¶ˆè€—Gasï¼Œè€ŒGasä»·æ ¼å’Œå®é™…æ¶ˆè€—çš„æ•°é‡å†³å®šäº†ä¸€ä¸ªäº¤æ˜“å®é™…æ¶ˆè€—çš„Etherï¼Œå³äº¤æ˜“æˆæœ¬ã€‚

åˆçº¦äº¤æ˜“æ— æ³•ç²¾ç¡®åœ°ç¡®å®šGasæ•°é‡ï¼Œåªèƒ½é¢„ä¼°å¹¶ç»™å‡ºGas Limitã€‚

#### åŸºæœ¬æµç¨‹

åœ¨æ¯”ç‰¹å¸ä¸­ï¼Œäº¤æ˜“å°±æ˜¯æ¶ˆè€—å·²æœ‰UTXOï¼Œå¹¶é€šè¿‡æ‰§è¡Œè„šæœ¬äº§ç”Ÿæ–°çš„UTXOï¼Œå…¶ä¸­éšå«çš„æ–°æ—§å·®é¢å³ä¸ºçŸ¿å·¥æ‰‹ç»­è´¹ã€‚

åœ¨ä»¥å¤ªåŠä¸­ï¼Œäº¤æ˜“ä¹Ÿéœ€è¦æ‰‹ç»­è´¹ï¼Œæ‰‹ç»­è´¹è¢«ç§°ä¸ºGasï¼ˆæ±½æ²¹ï¼‰ï¼Œå®ƒçš„è®¡ç®—æ¯”æ¯”ç‰¹å¸è¦å¤æ‚å¾—å¤šã€‚

ä»¥å¤ªåŠé™¤äº†æœ€åŸºæœ¬çš„è½¬è´¦ï¼šå³ä»ä¸€ä¸ªè´¦æˆ·æ”¯ä»˜Etheråˆ°å¦ä¸€ä¸ªè´¦æˆ·ï¼Œè¿˜æ”¯æŒæ‰§è¡Œåˆçº¦ä»£ç ã€‚åˆçº¦ä»£ç æ˜¯å›¾çµå®Œå¤‡çš„ç¼–ç¨‹è¯­è¨€ï¼Œé€šè¿‡EVMï¼ˆä»¥å¤ªåŠè™šæ‹Ÿæœºï¼‰æ‰§è¡Œã€‚å¦‚æœæŸä¸ªåˆçº¦ç¼–å†™äº†ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œé‚£ä¹ˆæ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œè¯¥åˆçº¦ä»£ç ï¼Œå²‚ä¸æ˜¯æ°¸è¿œæ— æ³•ç»“æŸï¼Ÿ

ä¸ºäº†ä¿è¯åˆçº¦ä»£ç çš„å¯é æ‰§è¡Œï¼Œä»¥å¤ªåŠç»™æ¯ä¸€ä¸ªè™šæ‹ŸæœºæŒ‡ä»¤éƒ½æ ‡è®°äº†ä¸€ä¸ªGasåŸºæœ¬è´¹ç”¨ï¼Œç§°ä¸ºgasUsedã€‚ä¾‹å¦‚ï¼ŒåŠ å‡è®¡ç®—çš„è´¹ç”¨æ˜¯3ï¼Œè®¡ç®—SHA3çš„è´¹ç”¨æ˜¯30ï¼Œè¾“å‡ºæ—¥å¿—çš„è´¹ç”¨æ˜¯375ï¼Œå†™å…¥å­˜å‚¨çš„è´¹ç”¨é«˜è¾¾20000ã€‚æ€»çš„æ¥è¯´ï¼Œæ¶ˆè€—CPUæ¯”æ¶ˆè€—å­˜å‚¨ä¾¿å®œï¼Œç®€å•è®¡ç®—æ¯”å¤æ‚è®¡ç®—ä¾¿å®œï¼Œè¯»å–æ¯”å†™å…¥ä¾¿å®œã€‚

é™¤äº†gasUsedå¤–ï¼Œç”¨æˆ·è¿˜éœ€è¦æä¾›ä¸€ä¸ªgasPriceï¼Œä»¥Gweiï¼ˆ1Gwei=109Weiï¼‰ä¸ºå•ä½ã€‚é€šè¿‡ç«ä»·å¾—åˆ°ä¸€ä¸ªçŸ¿å·¥æ„¿æ„æ¥å—çš„gasPriceã€‚å¦‚æœä¸€ä¸ªäº¤æ˜“æ¶ˆè€—äº†120000çš„gasUsedï¼Œè€ŒgasPriceæ˜¯50 Gweiï¼Œåˆ™äº¤æ˜“è´¹ç”¨æ˜¯ï¼š

```plain
120000 x 50 Gwei = 6000000 Gwei = 0.006 Ether
```



ä½†æ˜¯åœ¨æ‰§è¡Œä»£ç çš„æ—¶å€™ï¼Œå­˜åœ¨æ¡ä»¶åˆ¤æ–­ã€å¾ªç¯ç­‰è¯­å¥ï¼ŒåŒä¸€æ®µä»£ç ï¼Œæ‰§è¡Œçš„ç»“æœä¹Ÿå¯èƒ½ä¸åŒï¼Œå› æ­¤ï¼Œäº‹å‰é¢„è®¡ä¸€ä¸ªåˆçº¦æ‰§è¡Œè¦èŠ±è´¹å¤šå°‘Gasï¼Œä¸ç°å®ã€‚

æ‰€ä»¥ä»¥å¤ªåŠè§„å®šï¼Œä¸€ç¬”äº¤æ˜“ï¼Œå…ˆç»™å‡ºgasPriceå’ŒgasLimitï¼Œå¦‚æœæ‰§è¡Œå®Œæˆåæœ‰å‰©ä½™ï¼Œå‰©ä½™çš„é€€è¿˜ï¼Œå¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­æ¶ˆè€—æ®†å°½ï¼Œé‚£ä¹ˆäº¤æ˜“æ‰§è¡Œå¤±è´¥ï¼Œä½†å·²æ‰§è¡Œçš„Gasä¸ä¼šé€€ã€‚

å¤ªå¤æ‚äº†æ˜¯ä¸æ˜¯ï¼Ÿæˆ‘ä»¬è¿˜æ˜¯ä¸¾ä¸ªä¾‹å­ã€‚

å‡å®šæŸä¸ªè´¦æˆ·æƒ³æ‰§è¡Œä¸€ç¬”äº¤æ˜“ï¼Œä»–ç»™å‡ºgasPriceä¸º50 Gweiï¼Œé¢„ä¼°gasUsedçº¦120000ï¼Œè®¾å®šgasLimitä¸º150000ï¼Œåˆ™é¢„æ”¯ä»˜çš„Etherä¸ºï¼š

```plain
150000 x 50 Gwei = 7500000 Gwei = 0.0075 Ether
```



å¦‚æœè´¦æˆ·çš„Etherä½™é¢ä¸è¶³0.0075ï¼Œåˆ™è¯¥äº¤æ˜“æ ¹æœ¬æ— æ³•å‘é€ã€‚å¦‚æœè´¦æˆ·ä½™é¢ç­‰äºæˆ–è¶…è¿‡0.0075ï¼Œä¾‹å¦‚ä½™é¢ä¸º0.008ï¼Œåˆ™çŸ¿å·¥å¯ä»¥å°†è¯¥äº¤æ˜“æ‰“åŒ…ã€‚å‡è®¾å®é™…æ‰§è¡Œæ¶ˆè€—çš„gasUsedä¸º120000ï¼Œåˆ™äº¤æ˜“è´¹ç”¨0.006ï¼Œè´¦æˆ·å‰©ä½™0.002ã€‚

å¾ˆå°‘æœ‰äº¤æ˜“èƒ½å‡†ç¡®é¢„ä¼°gasUsedï¼Œåªæœ‰æ ‡å‡†è½¬è´¦äº¤æ˜“æ˜¯21000ï¼Œå› æ­¤ï¼Œæ ‡å‡†çš„è½¬è´¦äº¤æ˜“gasLimitå¯ä»¥è®¾ç½®ä¸º21000ï¼ˆå³æ°å¥½æ¶ˆè€—å®Œæ¯•æ— å‰©ä½™ï¼‰ã€‚

Gas Priceæ˜¯å…¨ç½‘ç”¨æˆ·ç«ä»·äº§ç”Ÿçš„ï¼Œå®ƒæ—¶åˆ»åœ¨æ³¢åŠ¨ã€‚å¦‚æœäº¤æ˜“å°‘ï¼ŒGas Priceå°†ä¸‹é™ï¼Œå¦‚æœäº¤æ˜“å¤šï¼Œç½‘ç»œæ‹¥å µï¼Œåˆ™Gas Priceå°†ä¸Šå‡ã€‚ä»¥å¤ªåŠçš„Gasä»·æ ¼å¯ä»¥åœ¨[Etherscan](https://etherscan.io/gastracker)è·Ÿè¸ªã€‚

#### äº¤æ˜“å›æ‰§

ä»¥å¤ªåŠåŒºå—ä¸ºæ¯ä¸€ç¬”äº¤æ˜“éƒ½ä¼šäº§ç”Ÿä¸€ç¬”å›æ‰§ï¼ˆReciptï¼‰ï¼Œè¡¨ç¤ºäº¤æ˜“çš„æœ€ç»ˆçŠ¶æ€ã€‚ä¸€ä¸ªå›æ‰§ä¿¡æ¯ä¸»è¦åŒ…æ‹¬ï¼š

- statusï¼šæ‰§è¡Œç»“æœï¼Œ1è¡¨ç¤ºæˆåŠŸï¼Œ0è¡¨ç¤ºå¤±è´¥ï¼›
- gasUsedï¼šå·²æ¶ˆè€—çš„Gasæ•°é‡ï¼›
- txHashï¼šäº¤æ˜“Hashï¼›
- logsï¼šäº¤æ˜“äº§ç”Ÿçš„æ—¥å¿—ï¼›
- â€¦â€¦

#### è½¬è´¦äº¤æ˜“

è½¬è´¦äº¤æ˜“æ˜¯æŒ‡ä¸¤ä¸ªå¤–éƒ¨è´¦å·è½¬ç§»Etherï¼Œæˆ‘ä»¬ä»¥äº¤æ˜“[0xb940...4ad7](https://etherscan.io/tx/0xb94087cdaa291e595ba02e846864cb9f5b681ca10efe2a91eb626d11101c4ad7)ä¸ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼š

- Transaction Hash: 0xb940...4ad7ï¼Œè¿™æ˜¯äº¤æ˜“Hashï¼Œå³äº¤æ˜“çš„å”¯ä¸€æ ‡è¯†ï¼›
- Status: Successï¼Œè¡¨ç¤ºäº¤æ˜“æˆåŠŸï¼›
- From: 0x0FFf...bBc4ï¼Œäº¤æ˜“çš„å‘é€æ–¹ï¼›
- To: 0x5b2a...5a46ï¼Œäº¤æ˜“çš„æ¥æ”¶æ–¹ï¼›
- Value: 1.6912 Etherï¼Œäº¤æ˜“å‘é€çš„Etherï¼›
- Gas Price: 82 Gweiï¼ŒGasçš„ä»·æ ¼ï¼›
- Gas Limit: 21,000ï¼Œè½¬è´¦äº¤æ˜“æ°å¥½æ¶ˆè€—21000Gasï¼Œå› æ­¤æ€»æ˜¯21000ï¼›
- Usage by Txn: 21,000 (100%)ï¼Œæ¶ˆè€—çš„Gaså æ¯”ï¼Œè¿™é‡Œæ°å¥½å…¨éƒ¨æ¶ˆè€—å®Œï¼›
- Nonceï¼š0ï¼Œå‘é€æ–¹çš„nonceï¼Œ0è¡¨ç¤ºç¬¬1ç¬”äº¤æ˜“ï¼›
- Input Data: 0xï¼Œå› ä¸ºæ˜¯è½¬è´¦äº¤æ˜“ï¼Œæ²¡æœ‰è¾“å…¥æ•°æ®ï¼Œå› æ­¤ä¸ºç©ºã€‚

#### åˆçº¦äº¤æ˜“

åˆçº¦äº¤æ˜“å°±æ˜¯æŒ‡ä¸€ä¸ªå¤–éƒ¨è´¦å·è°ƒç”¨æŸä¸ªåˆçº¦çš„æŸä¸ªpublicå‡½æ•°ã€‚æˆ‘ä»¬ä»¥äº¤æ˜“[0x8aff...8cd0](https://etherscan.io/tx/0x8affd7588219529b5b4652abd4bd9a2ad5b7aec1490d62ca359ae56a6c3c8cd0)ä¸ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼š

- From: 0x2329...BA3aï¼Œäº¤æ˜“çš„å‘èµ·æ–¹ï¼Œè¯¥åœ°å€ä¸€å®šæ˜¯å¤–éƒ¨è´¦æˆ·ï¼›
- To: 0x7a25...488Dï¼Œäº¤æ˜“çš„æ¥æ”¶æ–¹ï¼Œè¿™é‡Œåœ°å€æ˜¯ä¸€ä¸ªåˆçº¦åœ°å€ï¼›
- Value: 4.5 Etherï¼Œå³å‘åˆçº¦å‘é€4.5 Etherï¼›
- Gas Limit: 152,533ï¼Œè¿™æ˜¯äº¤æ˜“å‘èµ·å‰è®¾å®šçš„æœ€å¤§Gasï¼›
- Usage by Txn: 125,290 (82.14%)ï¼Œè¿™æ˜¯äº¤æ˜“å®é™…æ¶ˆè€—çš„Gasï¼›
- Input Data: 0x7ff36ab5...ï¼Œè¿™æ˜¯äº¤æ˜“çš„è¾“å…¥æ•°æ®ï¼Œå…¶ä¸­åŒ…å«äº†è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œä»¥åŠä¼ é€’çš„å‚æ•°ï¼Œè§£ç åå¯çŸ¥è°ƒç”¨å‡½æ•°æ˜¯`swapExactETHForTokens`ã€‚

å¯è§ï¼Œè½¬è´¦äº¤æ˜“çš„Gasè´¹ç”¨æ˜¯å›ºå®šçš„ï¼Œè€Œåˆçº¦äº¤æ˜“åªèƒ½é¢„ä¼°ï¼Œå…·ä½“è´¹ç”¨ä»¥å®é™…æ‰§è¡Œåæ¶ˆè€—çš„ä¸ºå‡†ã€‚





#### ä»€ä¹ˆæ˜¯ nonceï¼Ÿ

> åœ¨ä»¥å¤ªåŠä¸­ï¼Œ`nonce` æ˜¯ä¸€ä¸ªè´¦æˆ·å·²ç»å‘é€çš„äº¤æ˜“æ•°é‡ï¼Œæˆ–è¯´è¯¥è´¦æˆ·çš„äº¤æ˜“â€œè®¡æ•°å™¨â€ã€‚

å®ƒæ˜¯æ¯ä¸ªè´¦æˆ·ï¼ˆåŒ…æ‹¬æ™®é€šè´¦æˆ·å’Œåˆçº¦è´¦æˆ·ï¼‰éƒ½ç»´æŠ¤çš„ä¸€ä¸ªæ•°å­—ï¼š

- æ™®é€šåœ°å€ï¼š`nonce = è¯¥åœ°å€å·²ç»å‘å‡ºçš„äº¤æ˜“æ•°é‡`
- åˆçº¦åœ°å€éƒ¨ç½²æ—¶ï¼š`nonce = éƒ¨ç½²è€…åœ°å€å·²å‘å‡ºçš„äº¤æ˜“æ•°é‡`ï¼Œç”¨äºç”Ÿæˆåˆçº¦åœ°å€





**nonce çš„ä¸¤ä¸ªå…³é”®ç”¨é€”ï¼š**

1. ğŸ“¦ é˜²æ­¢äº¤æ˜“é‡æ”¾æ”»å‡»ï¼ˆReplay Attackï¼‰

- æ¯ç¬”äº¤æ˜“éƒ½å¿…é¡»å¸¦ä¸€ä¸ªå”¯ä¸€çš„ `nonce`
- å¦‚æœä½ é‡å¤å¹¿æ’­ä¸€æ¨¡ä¸€æ ·çš„äº¤æ˜“ï¼ˆåŒä¸€ä¸ª nonceï¼‰ï¼Œç½‘ç»œä¼šæ‹’ç»
- ç¡®ä¿æ¯ç¬”äº¤æ˜“å”¯ä¸€ä¸”æœ‰åºï¼Œä¸èƒ½è¢«å¤åˆ¶ä¼ªé€ 

------

2. ğŸ—ï¸ ç¡®å®šæ–°éƒ¨ç½²çš„åˆçº¦åœ°å€

å½“ä½ éƒ¨ç½²ä¸€ä¸ªæ–°æ™ºèƒ½åˆçº¦æ—¶ï¼Œ**åˆçº¦åœ°å€ä¸æ˜¯éšæœºçš„**ï¼Œè€Œæ˜¯ç”±ä¸‹é¢è¿™ä¸ªå…¬å¼ç¡®å®šï¼š

```
åˆçº¦åœ°å€ = keccak256(rlp_encode([éƒ¨ç½²è€…åœ°å€, éƒ¨ç½²è€…çš„ nonce])) çš„æœ€å 20 å­—èŠ‚
```

> æ‰€ä»¥ï¼Œä¸åŒ nonce éƒ¨ç½²å‡ºæ¥çš„åˆçº¦åœ°å€ä¹Ÿä¸åŒã€‚





### æ™ºèƒ½åˆçº¦

#### æ™ºèƒ½åˆçº¦

ä»¥å¤ªåŠç›¸æ¯”æ¯”ç‰¹å¸çš„ä¸€ä¸ªé‡å¤§åˆ›æ–°å°±æ˜¯å®ƒæ”¯æŒæ™ºèƒ½åˆçº¦ï¼ˆSmart Contractï¼‰ã€‚

æ‰€è°“æ™ºèƒ½åˆçº¦ï¼Œå°±æ˜¯ä¸€ç§è¿è¡Œåœ¨åŒºå—é“¾ä¸Šçš„ç¨‹åºã€‚å’Œæ™®é€šç¨‹åºä¸åŒçš„æ˜¯ï¼Œæ™ºèƒ½åˆçº¦è¦ä¿è¯åœ¨åŒºå—é“¾ç½‘ç»œçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸­è¿è¡Œçš„ç»“æœå®Œå…¨ç›¸åŒï¼Œè¿™æ ·æ‰èƒ½ä½¿ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥éªŒè¯æŒ–çŸ¿äº§å‡ºèŠ‚ç‚¹ç”Ÿæˆçš„åŒºå—é‡Œï¼Œæ™ºèƒ½åˆçº¦æ‰§è¡Œçš„ç»“æœå¯¹ä¸å¯¹ã€‚

å› æ­¤ï¼Œä»¥å¤ªåŠæä¾›äº†ä¸€ä¸ªEVMï¼ˆEthereum Virtual Machineï¼‰è™šæ‹Ÿæœºæ¥æ‰§è¡Œæ™ºèƒ½åˆçº¦çš„å­—èŠ‚ç ï¼Œå¹¶ä¸”ï¼Œå’Œæ™®é€šç¨‹åºç›¸æ¯”ï¼Œä¸ºäº†æ¶ˆé™¤ç¨‹åºè¿è¡Œçš„ä¸ç¡®å®šæ€§ï¼Œæ™ºèƒ½åˆçº¦æœ‰å¾ˆå¤šé™åˆ¶ï¼Œä¾‹å¦‚ï¼Œä¸æ”¯æŒæµ®ç‚¹è¿ç®—ï¼ˆå› ä¸ºæµ®ç‚¹æ•°æœ‰ä¸åŒçš„è¡¨ç¤ºæ–¹æ³•ï¼Œä¸åŒæ¶æ„çš„CPUè¿è¡Œçš„æµ®ç‚¹è®¡ç®—ç²¾åº¦éƒ½ä¸åŒï¼‰ï¼Œä¸æ”¯æŒéšæœºæ•°ï¼Œä¸æ”¯æŒä»å¤–éƒ¨è¯»å–è¾“å…¥ç­‰ç­‰ã€‚

ç±»ä¼¼äºJavaæºç è¢«ç¼–è¯‘ä¸ºJVMå¯æ‰§è¡Œçš„å­—èŠ‚ç ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ç§é«˜çº§è¯­è¨€æ¥ç¼–å†™æ™ºèƒ½åˆçº¦ï¼Œç„¶åç¼–è¯‘æˆEVMçš„å­—èŠ‚ç ã€‚æœ€å¸¸ç”¨çš„å¼€å‘æ™ºèƒ½åˆçº¦çš„è¯­è¨€æ˜¯ä»¥å¤ªåŠä¸“é—¨ä¸ºå…¶å®šåˆ¶çš„[Solidity](https://docs.soliditylang.org/)è¯­è¨€ï¼Œåç»­æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»Solidityçš„ç”¨æ³•ã€‚

ä¸€ä¸ªæ™ºèƒ½åˆçº¦è¢«ç¼–è¯‘åå°±æ˜¯ä¸€æ®µEVMå­—èŠ‚ç ï¼Œå°†å®ƒéƒ¨ç½²åœ¨ä»¥å¤ªåŠçš„åŒºå—é“¾æ—¶ï¼Œä¼šæ ¹æ®éƒ¨ç½²è€…çš„åœ°å€å’Œè¯¥åœ°å€çš„nonceåˆ†é…ä¸€ä¸ªåˆçº¦åœ°å€ï¼Œåˆçº¦åœ°å€å’Œè´¦æˆ·åœ°å€çš„æ ¼å¼æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œä½†åˆçº¦åœ°å€æ²¡æœ‰ç§é’¥ï¼Œä¹Ÿå°±æ²¡æœ‰äººèƒ½ç›´æ¥æ“ä½œè¯¥åœ°å€çš„åˆçº¦æ•°æ®ã€‚è¦è°ƒç”¨åˆçº¦ï¼Œå”¯ä¸€çš„æ–¹æ³•æ˜¯è°ƒç”¨åˆçº¦çš„å…¬å…±å‡½æ•°ã€‚

è¿™ä¹Ÿæ˜¯åˆçº¦çš„ä¸€ä¸ªé™åˆ¶ï¼šåˆçº¦ä¸èƒ½ä¸»åŠ¨æ‰§è¡Œï¼Œå®ƒåªèƒ½è¢«å¤–éƒ¨è´¦æˆ·å‘èµ·è°ƒç”¨ã€‚å¦‚æœä¸€ä¸ªåˆçº¦è¦å®šæœŸæ‰§è¡Œï¼Œé‚£åªèƒ½ç”±çº¿ä¸‹æœåŠ¡å™¨å®šæœŸå‘èµ·åˆçº¦è°ƒç”¨ã€‚

æ­¤å¤–ï¼Œåˆçº¦ä½œä¸ºåœ°å€ï¼Œå¯ä»¥æ¥æ”¶Etherï¼Œä¹Ÿå¯ä»¥å‘é€Etherã€‚åˆçº¦å†…éƒ¨ä¹Ÿå¯ä»¥å­˜å‚¨æ•°æ®ã€‚åˆçº¦çš„æ•°æ®å­˜å‚¨åœ¨åˆçº¦åœ°å€å…³è”çš„å­˜å‚¨ä¸Šï¼Œè¿™å°±ä½¿å¾—åˆçº¦å…·æœ‰äº†çŠ¶æ€ï¼Œå¯ä»¥å®ç°æ¯”è¾ƒå¤æ‚çš„é€»è¾‘ï¼ŒåŒ…æ‹¬å­˜æ¬¾ã€å–æ¬¾ç­‰ã€‚

åˆçº¦åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è°ƒç”¨å…¶ä»–å·²éƒ¨ç½²çš„åˆçº¦ï¼Œå‰ææ˜¯çŸ¥é“å…¶ä»–åˆçº¦çš„åœ°å€å’Œå‡½æ•°ç­¾åï¼Œè¿™å°±å¤§å¤§æ‰©å±•äº†åˆçº¦çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåˆçº¦å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªå€Ÿè´·åˆçº¦çš„å€Ÿæ¬¾æ–¹æ³•ï¼Œå†è°ƒç”¨äº¤æ˜“åˆçº¦ï¼Œæœ€åå†è°ƒç”¨è¿˜æ¬¾æ–¹æ³•ï¼Œå®ç°æ‰€è°“çš„â€œé—ªç”µè´·â€ï¼ˆå³åœ¨ä¸€ä¸ªåˆçº¦è°ƒç”¨ä¸­å®ç°å€Ÿæ¬¾-äº¤æ˜“-è¿˜æ¬¾ï¼‰åŠŸèƒ½ã€‚å¤šä¸ªåˆçº¦çš„åµŒå¥—è°ƒç”¨ä¹Ÿä½¿å¾—å› ä¸ºä»£ç ç¼–å†™çš„æ¼æ´å¯¼è‡´é»‘å®¢æ”»å‡»çš„å¯èƒ½æ€§å¤§å¤§å¢åŠ ã€‚ä¸ºäº†é¿å…æ¼æ´ï¼Œç¼–å†™åˆçº¦æ—¶éœ€è¦æ›´åŠ å°å¿ƒã€‚

#### å°ç»“

ä»¥å¤ªåŠé€šè¿‡EVMè™šæ‹Ÿæœºæ‰§è¡Œæ™ºèƒ½åˆçº¦ä»£ç ï¼›

åˆçº¦è¢«éƒ¨ç½²åå°†è‡ªåŠ¨è·å¾—ä¸€ä¸ªåœ°å€ï¼Œå¹¶å¯åƒå¤–éƒ¨è´¦æˆ·ä¸€æ ·å­˜å–Etherï¼Œè¿˜å¯ä»¥å­˜å‚¨çŠ¶æ€æ•°æ®ï¼›

åˆçº¦åªèƒ½è¢«åŠ¨åœ°è¢«å¤–éƒ¨è´¦æˆ·è°ƒç”¨ï¼Œä½†åœ¨æ‰§è¡Œæ—¶å¯ä»¥è°ƒç”¨å…¶ä»–åˆçº¦çš„å…¬å…±å‡½æ•°ã€‚

# ä»¥å¤ªåŠå¼€å‘æ–‡æ¡£

> [ä»¥å¤ªåŠå¼€å‘æ–‡æ¡£](https://ethereum.org/zh/developers/docs/)



